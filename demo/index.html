<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trustless AgentKit | Verifiable AI Agents on Base</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --coinbase-blue: #0052FF;
      --base-blue: #0052FF;
      --success-green: #00D632;
      --warning-orange: #FF9500;
      --error-red: #FF3B30;
      --glass-bg: rgba(255, 255, 255, 0.08);
      --glass-border: rgba(255, 255, 255, 0.15);
      --text-primary: #FFFFFF;
      --text-secondary: rgba(255, 255, 255, 0.7);
      --text-muted: rgba(255, 255, 255, 0.5);
      --bg-gradient: linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 50%, #0a1a2a 100%);
      --card-bg: rgba(0, 0, 0, 0.3);
      --header-bg: var(--glass-bg);
    }

    /* Light Mode */
    [data-theme="light"] {
      --glass-bg: rgba(0, 0, 0, 0.04);
      --glass-border: rgba(0, 0, 0, 0.1);
      --text-primary: #0a0a1a;
      --text-secondary: rgba(10, 10, 26, 0.7);
      --text-muted: rgba(10, 10, 26, 0.5);
      --bg-gradient: linear-gradient(135deg, #f8f9fc 0%, #eef1f8 50%, #f0f4fa 100%);
      --card-bg: rgba(255, 255, 255, 0.7);
      --header-bg: rgba(255, 255, 255, 0.8);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Space Grotesk', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-gradient);
      min-height: 100vh;
      color: var(--text-primary);
      overflow-x: hidden;
      transition: background 0.3s ease, color 0.3s ease;
    }

    /* Animated background */
    .bg-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }

    .bg-animation::before {
      content: '';
      position: absolute;
      width: 200%;
      height: 200%;
      top: -50%;
      left: -50%;
      background: radial-gradient(circle at 30% 40%, rgba(0, 82, 255, 0.15) 0%, transparent 50%),
                  radial-gradient(circle at 70% 60%, rgba(0, 214, 50, 0.1) 0%, transparent 40%),
                  radial-gradient(circle at 50% 80%, rgba(0, 82, 255, 0.1) 0%, transparent 50%);
      animation: bgPulse 15s ease-in-out infinite;
    }

    @keyframes bgPulse {
      0%, 100% { transform: translate(0, 0) scale(1); }
      50% { transform: translate(-5%, -5%) scale(1.1); }
    }

    /* Header */
    header {
      padding: 24px 48px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      backdrop-filter: blur(20px);
      background: var(--header-bg);
      border-bottom: 1px solid var(--glass-border);
      position: sticky;
      top: 0;
      z-index: 100;
      transition: background 0.3s ease;
    }

    /* Theme Toggle */
    .theme-toggle {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      background: var(--glass-bg);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      transition: all 0.3s ease;
      margin-right: 16px;
    }

    .theme-toggle:hover {
      transform: scale(1.05);
      border-color: var(--coinbase-blue);
    }

    .theme-toggle .icon-sun { display: none; }
    .theme-toggle .icon-moon { display: block; }

    [data-theme="light"] .theme-toggle .icon-sun { display: block; }
    [data-theme="light"] .theme-toggle .icon-moon { display: none; }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: transparent;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
    }

    .logo-text {
      font-size: 20px;
      font-weight: 600;
    }

    .logo-text span {
      color: var(--text-secondary);
      font-weight: 400;
    }

    .header-badges {
      display: flex;
      gap: 12px;
    }

    .badge {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .badge.coinbase {
      border-color: var(--coinbase-blue);
      color: var(--coinbase-blue);
    }

    .badge.base {
      border-color: var(--coinbase-blue);
      background: rgba(0, 82, 255, 0.1);
    }

    .badge.live {
      border-color: var(--success-green);
    }

    .badge.live::before {
      content: '';
      width: 8px;
      height: 8px;
      background: var(--success-green);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .service-status {
      display: flex;
      gap: 8px;
      padding: 6px 12px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      font-size: 11px;
    }

    .service-indicator {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .service-indicator .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--text-muted);
    }

    .service-indicator.active .dot {
      background: var(--success-green);
      animation: pulse 2s infinite;
    }

    .service-indicator.inactive .dot {
      background: var(--error-red);
    }

    /* Hero Section */
    .hero {
      padding: 80px 48px;
      text-align: center;
      max-width: 1000px;
      margin: 0 auto;
    }

    .hero h1 {
      font-size: 56px;
      font-weight: 700;
      line-height: 1.1;
      margin-bottom: 24px;
      background: linear-gradient(135deg, #fff 0%, rgba(255,255,255,0.8) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    [data-theme="light"] .hero h1 {
      background: linear-gradient(135deg, #0a0a1a 0%, rgba(10,10,26,0.8) 100%);
      -webkit-background-clip: text;
      background-clip: text;
    }

    .hero h1 .highlight {
      background: linear-gradient(135deg, var(--coinbase-blue), var(--success-green));
      -webkit-background-clip: text;
      background-clip: text;
    }

    .hero p {
      font-size: 20px;
      color: var(--text-secondary);
      max-width: 700px;
      margin: 0 auto 40px;
      line-height: 1.6;
    }

    .pillars {
      display: flex;
      gap: 24px;
      justify-content: center;
      margin-bottom: 40px;
    }

    .pillar {
      padding: 24px 32px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      backdrop-filter: blur(20px);
      min-width: 280px;
    }

    .pillar h3 {
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .pillar h2 {
      font-size: 20px;
      margin-bottom: 8px;
    }

    .pillar p {
      font-size: 14px;
      color: var(--text-secondary);
      margin: 0;
    }

    .pillar.inference { border-top: 3px solid var(--coinbase-blue); }
    .pillar.memory { border-top: 3px solid var(--success-green); }

    /* Main Demo Area */
    .demo-container {
      padding: 0 48px 80px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .demo-header {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 32px;
    }

    .demo-header h2 {
      font-size: 28px;
      margin: 0;
    }

    .demo-description {
      color: rgba(255, 255, 255, 0.7);
      font-size: 15px;
      line-height: 1.6;
      max-width: 900px;
      margin: 0;
    }

    .demo-controls {
      display: flex;
      gap: 12px;
    }

    .btn {
      padding: 12px 24px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--coinbase-blue), #0066FF);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 40px rgba(0, 82, 255, 0.3);
    }

    .btn-secondary {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      color: white;
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    /* Workflow Grid */
    .workflow-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      align-items: start;
    }

    .workflow-panel {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      backdrop-filter: blur(20px);
      overflow: hidden;
      height: 920px;
    }

    .workflow-panel.attack-panel {
      height: auto;
    }

    .panel-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--glass-border);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .panel-icon {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .panel-icon.blue { background: rgba(0, 82, 255, 0.2); }
    .panel-icon.green { background: rgba(0, 214, 50, 0.2); }
    .panel-icon.orange { background: rgba(255, 149, 0, 0.2); }
    .panel-icon.purple { background: rgba(147, 51, 234, 0.2); }

    .panel-title {
      font-size: 16px;
      font-weight: 600;
    }

    .panel-subtitle {
      font-size: 12px;
      color: var(--text-muted);
    }

    .panel-content {
      padding: 24px;
    }

    /* Agent Cards */
    .agent-card {
      background: var(--card-bg);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      transition: background 0.3s ease;
    }

    .agent-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .agent-avatar {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .agent-avatar.buyer { background: linear-gradient(135deg, #3B82F6, #1D4ED8); }
    .agent-avatar.seller { background: linear-gradient(135deg, #10B981, #059669); }

    .agent-info h4 {
      font-size: 16px;
      margin-bottom: 4px;
    }

    .agent-info p {
      font-size: 12px;
      color: var(--text-muted);
    }

    .agent-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .stat {
      text-align: center;
      padding: 12px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
    }

    .stat-value {
      font-size: 18px;
      font-weight: 600;
      font-family: 'JetBrains Mono', monospace;
    }

    .stat-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Transaction Flow */
    .tx-flow {
      position: relative;
      padding-left: 20px;
    }

    @keyframes flowPulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }

    .tx-step {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
      opacity: 0.4;
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      min-height: 160px;
    }

    .tx-step:last-child {
      margin-bottom: 0;
    }

    .tx-step.active {
      opacity: 1;
      transform: translateX(4px);
    }

    .tx-step.completed {
      opacity: 0.85;
    }

    .step-indicator {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--glass-bg);
      border: 2px solid var(--glass-border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      flex-shrink: 0;
      position: relative;
      z-index: 2;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .tx-step.active .step-indicator {
      border-color: var(--coinbase-blue);
      background: rgba(0, 82, 255, 0.2);
      animation: stepPulse 1.5s infinite;
      transform: scale(1.1);
    }

    .tx-step.completed .step-indicator {
      border-color: var(--success-green);
      background: rgba(0, 214, 50, 0.2);
    }

    /* Keep step number visible when completed, just turn green */
    .tx-step.completed .step-indicator .step-num {
      color: var(--success-green);
    }

    @keyframes stepPulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(0, 82, 255, 0.4); }
      50% { box-shadow: 0 0 0 12px rgba(0, 82, 255, 0); }
    }

    .step-content {
      flex: 1;
    }

    .step-content h4 {
      font-size: 14px;
      margin-bottom: 4px;
    }

    .step-content p {
      font-size: 12px;
      color: var(--text-muted);
    }

    .step-detail {
      margin-top: 12px;
      padding: 12px;
      background: var(--card-bg);
      border-radius: 10px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      color: var(--text-secondary);
      display: none;
      transition: background 0.3s ease;
    }

    .tx-step.active .step-detail,
    .tx-step.completed .step-detail {
      display: block;
    }

    /* Proof Panel */
    .proof-display {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      font-family: 'JetBrains Mono', monospace;
      transition: background 0.3s ease;
    }

    .proof-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .proof-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
    }

    .proof-status {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 500;
    }

    .proof-status.verified {
      background: rgba(0, 214, 50, 0.2);
      color: var(--success-green);
      animation: verifiedPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .proof-status.pending {
      background: rgba(255, 149, 0, 0.2);
      color: var(--warning-orange);
    }

    @keyframes verifiedPop {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }

    /* Dramatic verification overlay */
    .verification-flash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at center, rgba(0, 214, 50, 0.3) 0%, transparent 70%);
      pointer-events: none;
      z-index: 1000;
      animation: flashIn 1s ease-out forwards;
    }

    @keyframes flashIn {
      0% { opacity: 0; transform: scale(0.8); }
      20% { opacity: 1; transform: scale(1.1); }
      100% { opacity: 0; transform: scale(1.5); }
    }

    /* Proof display verified state */
    .proof-display.verified {
      border: 2px solid var(--success-green);
      box-shadow: 0 0 30px rgba(0, 214, 50, 0.3);
      animation: proofVerified 0.8s ease-out;
    }

    @keyframes proofVerified {
      0% { box-shadow: 0 0 0 rgba(0, 214, 50, 0); }
      50% { box-shadow: 0 0 50px rgba(0, 214, 50, 0.5); }
      100% { box-shadow: 0 0 30px rgba(0, 214, 50, 0.3); }
    }

    /* Success checkmark animation */
    .verified-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: linear-gradient(135deg, rgba(0, 214, 50, 0.2), rgba(0, 214, 50, 0.1));
      border: 1px solid var(--success-green);
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      color: var(--success-green);
      animation: badgeSlideIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @keyframes badgeSlideIn {
      0% { opacity: 0; transform: translateY(-10px) scale(0.8); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }

    .proof-content {
      font-size: 11px;
      line-height: 1.8;
      color: var(--text-secondary);
      word-break: break-all;
    }

    .proof-line {
      display: flex;
      gap: 12px;
      margin-bottom: 8px;
    }

    .proof-label {
      color: var(--coinbase-blue);
      min-width: 100px;
    }

    .proof-value {
      color: var(--text-primary);
    }

    .proof-value.hash {
      color: var(--success-green);
    }

    /* Memory Panel */
    .memory-item {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      border-left: 3px solid var(--success-green);
      transition: background 0.3s ease;
    }

    .memory-item h5 {
      font-size: 13px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .memory-item p {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .memory-meta {
      display: flex;
      gap: 16px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .memory-meta span {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    /* Merkle Tree Visualization */
    .merkle-tree {
      text-align: center;
      padding: 20px;
      position: relative;
    }

    .merkle-node {
      display: inline-block;
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 10px;
      margin: 4px;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      cursor: pointer;
      position: relative;
      color: var(--text-secondary);
    }

    .merkle-node:hover {
      transform: translateY(-4px) scale(1.05);
      box-shadow: 0 8px 25px rgba(255, 255, 255, 0.15);
      z-index: 10;
      border-color: var(--coinbase-blue);
    }

    .merkle-node.root {
      background: rgba(0, 82, 255, 0.2);
      border-color: var(--coinbase-blue);
      color: var(--coinbase-blue);
      animation: rootGlow 3s ease-in-out infinite;
      font-weight: 500;
    }

    .merkle-node.root:hover {
      box-shadow: 0 8px 25px rgba(0, 82, 255, 0.4);
    }

    @keyframes rootGlow {
      0%, 100% { box-shadow: 0 0 10px rgba(0, 82, 255, 0.2); }
      50% { box-shadow: 0 0 20px rgba(0, 82, 255, 0.4); }
    }

    .merkle-node.leaf {
      background: rgba(0, 214, 50, 0.15);
      border-color: var(--success-green);
      color: var(--success-green);
    }

    .merkle-node.leaf:hover {
      border-color: var(--success-green);
      box-shadow: 0 8px 25px rgba(0, 214, 50, 0.3);
    }

    .merkle-node.updating {
      animation: nodeUpdate 0.6s ease-out;
    }

    @keyframes nodeUpdate {
      0% { transform: scale(1); background: rgba(0, 214, 50, 0.2); }
      50% { transform: scale(1.2); background: rgba(0, 214, 50, 0.5); box-shadow: 0 0 30px rgba(0, 214, 50, 0.6); }
      100% { transform: scale(1); background: rgba(0, 214, 50, 0.2); }
    }

    .merkle-level {
      margin-bottom: 16px;
      position: relative;
    }

    /* Connection lines between merkle nodes */
    .merkle-tree::before {
      content: '';
      position: absolute;
      top: 50px;
      left: 50%;
      width: 2px;
      height: 20px;
      background: linear-gradient(to bottom, var(--success-green), var(--coinbase-blue));
      opacity: 0.5;
    }

    /* Bottom Stats */
    .stats-bar {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 24px;
      padding: 40px 48px;
      background: var(--glass-bg);
      border-top: 1px solid var(--glass-border);
      margin-top: 60px;
    }

    .stats-item {
      text-align: center;
    }

    .stats-item .value {
      font-size: 36px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
      background: linear-gradient(135deg, var(--coinbase-blue), var(--success-green));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .stats-item .label {
      font-size: 14px;
      color: var(--text-muted);
      margin-top: 8px;
    }

    /* Attack Scenario */
    .attack-panel {
      grid-column: span 2;
      background: linear-gradient(135deg, rgba(255, 59, 48, 0.1), rgba(255, 149, 0, 0.1));
      border: 1px solid rgba(255, 59, 48, 0.3);
    }

    .attack-panel .panel-header {
      border-bottom-color: rgba(255, 59, 48, 0.3);
    }

    .attack-scenario {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }

    .scenario-box {
      padding: 20px;
      border-radius: 12px;
    }

    .scenario-box.without {
      background: rgba(255, 59, 48, 0.1);
      border: 1px solid rgba(255, 59, 48, 0.3);
    }

    .scenario-box.with {
      background: rgba(0, 214, 50, 0.1);
      border: 1px solid rgba(0, 214, 50, 0.3);
    }

    .scenario-box h4 {
      font-size: 14px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .scenario-box ul {
      list-style: none;
      font-size: 13px;
      color: var(--text-secondary);
    }

    .scenario-box li {
      margin-bottom: 8px;
      padding-left: 20px;
      position: relative;
    }

    .scenario-box.without li::before {
      content: '✗';
      position: absolute;
      left: 0;
      color: var(--error-red);
    }

    .scenario-box.with li::before {
      content: '✓';
      position: absolute;
      left: 0;
      color: var(--success-green);
    }

    /* Minimalist translucent icons */
    .icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 1em;
      height: 1em;
      opacity: 0.6;
    }
    .icon svg {
      width: 100%;
      height: 100%;
      fill: currentColor;
    }
    .icon-lg {
      width: 24px;
      height: 24px;
    }
    .icon-md {
      width: 20px;
      height: 20px;
    }
    .icon-sm {
      width: 16px;
      height: 16px;
    }

    /* Footer */
    footer {
      padding: 40px 48px;
      text-align: center;
      border-top: 1px solid var(--glass-border);
    }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: 32px;
      margin-bottom: 24px;
    }

    .footer-links a {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      transition: color 0.3s;
    }

    .footer-links a:hover {
      color: var(--coinbase-blue);
    }

    .footer-tagline {
      font-size: 16px;
      color: var(--text-muted);
    }

    .footer-tagline strong {
      color: var(--text-primary);
    }

    /* Deployed Contracts Section */
    .contracts-section {
      padding: 60px 48px;
      background: var(--glass-bg);
      border-top: 1px solid var(--glass-border);
      border-bottom: 1px solid var(--glass-border);
    }

    .contracts-section h2 {
      text-align: center;
      font-size: 28px;
      margin-bottom: 12px;
    }

    .contracts-section .subtitle {
      text-align: center;
      color: var(--text-secondary);
      margin-bottom: 32px;
      font-size: 16px;
    }

    .contracts-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .contract-card {
      background: var(--card-bg);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      transition: all 0.3s ease;
    }

    .contract-card:hover {
      transform: translateY(-4px);
      border-color: var(--coinbase-blue);
      box-shadow: 0 12px 40px rgba(0, 82, 255, 0.15);
    }

    .contract-card .icon {
      font-size: 32px;
      margin-bottom: 12px;
    }

    .contract-card h4 {
      font-size: 14px;
      margin-bottom: 8px;
    }

    .contract-card .address {
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      color: var(--coinbase-blue);
      word-break: break-all;
      margin-bottom: 12px;
    }

    .contract-card a {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: rgba(0, 82, 255, 0.1);
      border: 1px solid var(--coinbase-blue);
      border-radius: 8px;
      color: var(--coinbase-blue);
      text-decoration: none;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .contract-card a:hover {
      background: var(--coinbase-blue);
      color: white;
    }

    /* Built With Section */
    .built-with {
      padding: 48px;
      text-align: center;
    }

    .built-with h3 {
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: var(--text-muted);
      margin-bottom: 32px;
    }

    .logo-row {
      display: flex;
      justify-content: space-evenly;
      align-items: center;
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
    }

    .partner-logo {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      opacity: 0.7;
      transition: all 0.3s ease;
      text-decoration: none;
      color: var(--text-primary);
    }

    .partner-logo:hover {
      opacity: 1;
      transform: translateY(-4px);
    }

    .partner-logo .logo-icon-large {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
    }

    .partner-logo span {
      font-size: 12px;
      font-weight: 500;
    }

    /* Comparison Table */
    .comparison-section {
      padding: 80px 48px;
      max-width: 900px;
      margin: 0 auto;
    }

    .comparison-section h2 {
      text-align: center;
      font-size: 28px;
      margin-bottom: 12px;
    }

    .comparison-section .subtitle {
      text-align: center;
      color: var(--text-secondary);
      margin-bottom: 40px;
    }

    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--glass-bg);
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid var(--glass-border);
    }

    .comparison-table th,
    .comparison-table td {
      padding: 16px 24px;
      text-align: left;
      border-bottom: 1px solid var(--glass-border);
    }

    .comparison-table th {
      background: rgba(0, 82, 255, 0.1);
      font-weight: 600;
      font-size: 14px;
    }

    .comparison-table th:first-child {
      width: 50%;
    }

    .comparison-table td {
      font-size: 14px;
    }

    .comparison-table tr:last-child td {
      border-bottom: none;
    }

    .comparison-table .feature {
      color: var(--text-primary);
    }

    .comparison-table .check {
      color: var(--success-green);
      font-size: 18px;
    }

    .comparison-table .cross {
      color: var(--error-red);
      font-size: 18px;
    }

    .comparison-table .highlight-col {
      background: rgba(0, 214, 50, 0.05);
    }

    /* Architecture Diagram */
    .architecture-section {
      padding: 80px 48px;
      text-align: center;
    }

    .architecture-section h2 {
      font-size: 28px;
      margin-bottom: 12px;
    }

    .architecture-section .subtitle {
      color: var(--text-secondary);
      margin-bottom: 48px;
    }

    .architecture-diagram {
      max-width: 1000px;
      margin: 0 auto;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 24px;
      padding: 48px;
    }

    .arch-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 24px;
      margin-bottom: 24px;
    }

    .arch-box {
      padding: 20px 32px;
      border-radius: 12px;
      font-weight: 500;
      text-align: center;
      transition: all 0.3s ease;
    }

    .arch-box:hover {
      transform: translateY(-4px);
    }

    .arch-box.agent {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(29, 78, 216, 0.2));
      border: 1px solid #3B82F6;
      min-width: 200px;
      min-height: 130px;
    }

    .arch-box.trustless-layer {
      background: linear-gradient(135deg, rgba(0, 82, 255, 0.15), rgba(0, 214, 50, 0.15));
      border: 2px solid var(--coinbase-blue);
      padding: 32px 48px;
      min-width: 600px;
    }

    .arch-box.base {
      background: linear-gradient(135deg, rgba(0, 82, 255, 0.2), rgba(0, 82, 255, 0.1));
      border: 1px solid var(--coinbase-blue);
    }

    .arch-box.kinic {
      background: linear-gradient(135deg, rgba(0, 214, 50, 0.2), rgba(0, 214, 50, 0.1));
      border: 1px solid var(--success-green);
    }

    .arch-box h4 {
      font-size: 16px;
      margin-bottom: 4px;
    }

    .arch-box p {
      font-size: 12px;
      color: var(--text-secondary);
      margin: 0;
    }

    .arch-arrow {
      font-size: 24px;
      color: var(--text-muted);
    }

    .arch-pillars {
      display: flex;
      justify-content: center;
      gap: 48px;
      margin-top: 16px;
    }

    .arch-pillar {
      padding: 16px 24px;
      border-radius: 10px;
      text-align: center;
    }

    .arch-pillar.zkml {
      background: rgba(0, 82, 255, 0.1);
      border: 1px solid rgba(0, 82, 255, 0.3);
    }

    .arch-pillar.memory {
      background: rgba(0, 214, 50, 0.1);
      border: 1px solid rgba(0, 214, 50, 0.3);
    }

    .arch-pillar h5 {
      font-size: 13px;
      margin-bottom: 4px;
    }

    .arch-pillar p {
      font-size: 11px;
      color: var(--text-muted);
      margin: 0;
    }

    /* Try It Now Section */
    .try-section {
      padding: 80px 48px;
      background: linear-gradient(135deg, rgba(0, 82, 255, 0.05), rgba(0, 214, 50, 0.05));
      border-top: 1px solid var(--glass-border);
      border-bottom: 1px solid var(--glass-border);
    }

    .try-section h2 {
      text-align: center;
      font-size: 28px;
      margin-bottom: 12px;
    }

    .try-section .subtitle {
      text-align: center;
      color: var(--text-secondary);
      margin-bottom: 40px;
    }

    .try-container {
      max-width: 800px;
      margin: 0 auto;
    }

    .try-input-group {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
    }

    .try-input {
      flex: 1;
      padding: 16px 20px;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      background: var(--glass-bg);
      color: var(--text-primary);
      font-size: 16px;
      font-family: inherit;
      outline: none;
      transition: all 0.3s ease;
    }

    .try-input:focus {
      border-color: var(--coinbase-blue);
      box-shadow: 0 0 0 3px rgba(0, 82, 255, 0.1);
    }

    .try-input::placeholder {
      color: var(--text-muted);
    }

    .try-btn {
      padding: 16px 32px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--coinbase-blue), #0066FF);
      color: white;
      font-size: 16px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .try-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 40px rgba(0, 82, 255, 0.3);
    }

    .try-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .try-output {
      background: var(--card-bg);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 24px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      min-height: 200px;
      position: relative;
      overflow: hidden;
    }

    .try-output .output-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--glass-border);
    }

    .try-output .output-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
    }

    .try-output .output-timer {
      font-size: 14px;
      color: var(--coinbase-blue);
    }

    .try-output .output-content {
      line-height: 1.8;
      color: var(--text-secondary);
    }

    .try-output .output-line {
      margin-bottom: 8px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .try-output .output-line.success {
      color: var(--success-green);
    }

    .try-output .output-line.pending {
      color: var(--warning-orange);
    }

    .try-output .output-line .spinner {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid var(--glass-border);
      border-top-color: var(--coinbase-blue);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* On-Chain Activity Section */
    .activity-section {
      padding: 60px 48px;
      background: linear-gradient(135deg, rgba(0, 214, 50, 0.03), rgba(0, 82, 255, 0.03));
    }

    .activity-section h2 {
      text-align: center;
      font-size: 28px;
      margin-bottom: 12px;
    }

    .activity-section .subtitle {
      text-align: center;
      color: var(--text-secondary);
      margin-bottom: 32px;
      font-size: 16px;
    }

    .activity-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .activity-card {
      background: var(--card-bg);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 24px;
      transition: all 0.3s ease;
    }

    .activity-card:hover {
      transform: translateY(-4px);
      border-color: var(--coinbase-blue);
      box-shadow: 0 12px 40px rgba(0, 82, 255, 0.15);
    }

    .activity-card .activity-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .activity-card .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .activity-card .activity-icon.deploy { background: rgba(0, 82, 255, 0.15); }
    .activity-card .activity-icon.attestation { background: rgba(0, 214, 50, 0.15); }
    .activity-card .activity-icon.memory { background: rgba(147, 51, 234, 0.15); }
    .activity-card .activity-icon.payment { background: rgba(255, 149, 0, 0.15); }

    .activity-card h4 {
      font-size: 14px;
      margin-bottom: 2px;
    }

    .activity-card .activity-time {
      font-size: 11px;
      color: var(--text-muted);
    }

    .activity-card .activity-detail {
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      color: var(--text-secondary);
      background: rgba(0, 0, 0, 0.2);
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 12px;
      word-break: break-all;
    }

    .activity-card .activity-detail strong {
      color: var(--text-primary);
      display: block;
      margin-bottom: 4px;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .activity-card a.activity-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: rgba(0, 82, 255, 0.1);
      border: 1px solid var(--coinbase-blue);
      border-radius: 8px;
      color: var(--coinbase-blue);
      text-decoration: none;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .activity-card a.activity-link:hover {
      background: var(--coinbase-blue);
      color: white;
    }

    .activity-card a.activity-link.kinic-link {
      border-color: var(--success-green);
      color: var(--success-green);
      background: rgba(0, 214, 50, 0.1);
    }

    .activity-card a.activity-link.kinic-link:hover {
      background: var(--success-green);
      color: white;
    }

    /* Live Agents Section */
    .live-agents-section {
      padding: 60px 48px;
      background: linear-gradient(135deg, rgba(147, 51, 234, 0.05), rgba(0, 82, 255, 0.05));
      border-top: 1px solid var(--glass-border);
    }

    .live-agents-section h2 {
      text-align: center;
      font-size: 28px;
      margin-bottom: 8px;
    }

    .live-agents-section .live-badge {
      display: inline-block;
      background: var(--success-green);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      margin-left: 12px;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .live-agents-section .subtitle {
      text-align: center;
      color: var(--text-secondary);
      margin-bottom: 32px;
      font-size: 16px;
    }

    .agents-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      max-width: 1200px;
      margin: 0 auto 32px;
    }

    .agent-card {
      background: var(--card-bg);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 24px;
      transition: all 0.3s ease;
    }

    .agent-card:hover {
      transform: translateY(-4px);
      border-color: rgba(147, 51, 234, 0.5);
      box-shadow: 0 12px 40px rgba(147, 51, 234, 0.15);
    }

    .agent-card .agent-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .agent-card h4 {
      font-size: 16px;
      margin-bottom: 4px;
    }

    .agent-card .agent-type {
      font-size: 12px;
      color: var(--text-muted);
    }

    .agent-card .trust-score {
      background: rgba(0, 214, 50, 0.15);
      color: var(--success-green);
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
    }

    .agent-card .agent-description {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.5;
      margin-bottom: 16px;
    }

    .agent-card .agent-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 12px;
      border-top: 1px solid var(--glass-border);
    }

    .agent-card .agent-price {
      font-family: 'JetBrains Mono', monospace;
      font-size: 14px;
      color: var(--coinbase-blue);
      font-weight: 600;
    }

    .agent-card .agent-tags {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .agent-card {
      cursor: pointer;
    }

    .agent-card .agent-tag {
      background: rgba(0, 82, 255, 0.1);
      color: var(--coinbase-blue);
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 10px;
    }

    /* Agent Detail Modal */
    .agent-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .agent-modal-overlay.active {
      display: flex;
    }

    .agent-modal {
      background: var(--bg-secondary);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      max-width: 700px;
      width: 100%;
      max-height: 85vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .agent-modal-header {
      padding: 24px;
      border-bottom: 1px solid var(--glass-border);
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }

    .agent-modal-header h3 {
      font-size: 22px;
      margin-bottom: 4px;
    }

    .agent-modal-header .agent-type {
      font-size: 13px;
      color: var(--text-muted);
    }

    .agent-modal-close {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: var(--text-secondary);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      transition: all 0.2s ease;
    }

    .agent-modal-close:hover {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }

    .agent-modal-body {
      padding: 24px;
      overflow-y: auto;
      flex: 1;
    }

    .agent-modal-section {
      margin-bottom: 24px;
    }

    .agent-modal-section:last-child {
      margin-bottom: 0;
    }

    .agent-modal-section h4 {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .agent-modal-section h4::before {
      content: '';
      width: 3px;
      height: 14px;
      background: var(--coinbase-blue);
      border-radius: 2px;
    }

    .agent-data-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .agent-data-item {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 14px;
    }

    .agent-data-item.full-width {
      grid-column: span 2;
    }

    .agent-data-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 6px;
    }

    .agent-data-value {
      font-size: 14px;
      color: var(--text-primary);
      font-family: 'JetBrains Mono', monospace;
      word-break: break-all;
    }

    .agent-data-value.large {
      font-size: 20px;
      font-weight: 600;
    }

    .agent-data-value.success {
      color: var(--success-green);
    }

    .agent-data-value.blue {
      color: var(--coinbase-blue);
    }

    .agent-memory-list {
      background: var(--card-bg);
      border-radius: 10px;
      overflow: hidden;
    }

    .agent-memory-item {
      padding: 14px;
      border-bottom: 1px solid var(--glass-border);
      font-size: 13px;
    }

    .agent-memory-item:last-child {
      border-bottom: none;
    }

    .agent-memory-item .memory-tag {
      font-size: 10px;
      color: var(--coinbase-blue);
      background: rgba(0, 82, 255, 0.1);
      padding: 2px 8px;
      border-radius: 4px;
      margin-bottom: 6px;
      display: inline-block;
    }

    .agent-memory-item .memory-content {
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .agent-memory-item .memory-similarity {
      font-size: 11px;
      color: var(--success-green);
      margin-top: 6px;
    }

    .agent-modal-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 24px;
      color: var(--text-secondary);
    }

    .agent-modal-loading .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--glass-border);
      border-top-color: var(--coinbase-blue);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 16px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .agent-modal-error {
      background: rgba(255, 100, 100, 0.1);
      border: 1px solid rgba(255, 100, 100, 0.3);
      border-radius: 10px;
      padding: 16px;
      color: #ff6464;
      text-align: center;
    }

    .kinic-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(0, 214, 50, 0.1);
      border: 1px solid var(--success-green);
      color: var(--success-green);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }

    .kinic-badge::before {
      content: '';
      width: 8px;
      height: 8px;
      background: var(--success-green);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    .kinic-info {
      text-align: center;
      padding: 20px;
      background: var(--glass-bg);
      border-radius: 12px;
      max-width: 600px;
      margin: 0 auto;
    }

    .kinic-info p {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 12px;
    }

    .kinic-info code {
      font-family: 'JetBrains Mono', monospace;
      background: rgba(0, 0, 0, 0.3);
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .workflow-grid {
        grid-template-columns: 1fr;
      }

      .attack-panel {
        grid-column: span 1;
      }

      .attack-scenario {
        grid-template-columns: 1fr;
      }

      .contracts-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .arch-box.trustless-layer {
        min-width: auto;
        padding: 24px;
      }

      .arch-row {
        flex-direction: column;
      }

      .arch-arrow {
        transform: rotate(90deg);
      }
    }

    @media (max-width: 768px) {
      .hero h1 { font-size: 36px; }
      .pillars { flex-direction: column; align-items: center; }
      .stats-bar { grid-template-columns: repeat(2, 1fr); }
      header { padding: 16px 24px; }
      .demo-container { padding: 0 24px 40px; }

      .contracts-grid {
        grid-template-columns: 1fr;
      }

      .contracts-section { padding: 40px 24px; }
      .try-section { padding: 40px 24px; }
      .architecture-section { padding: 40px 24px; }
      .comparison-section { padding: 40px 24px; }

      .try-input-group {
        flex-direction: column;
      }

      .try-btn {
        width: 100%;
      }

      .logo-row {
        flex-wrap: wrap;
        gap: 24px;
        justify-content: center;
      }

      .arch-pillars {
        flex-direction: column;
        gap: 16px;
      }

      .comparison-table th,
      .comparison-table td {
        padding: 12px 16px;
        font-size: 13px;
      }
    }
  </style>
</head>
<body>
  <div class="bg-animation"></div>

  <header>
    <div class="logo">
      <div class="logo-icon" style="padding: 0; overflow: hidden;"><img src="https://pbs.twimg.com/profile_images/1481435011182120960/rh1y1oEw_400x400.jpg" alt="Trustless" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;"></div>
      <div class="logo-text">Trustless <span>AgentKit</span></div>
    </div>
    <div class="header-badges">
      <div class="service-status" id="serviceStatus" title="Real service connections">
        <div class="service-indicator" id="proverStatus">
          <span class="dot"></span>
          <span>Prover</span>
        </div>
        <div class="service-indicator" id="kinicStatus">
          <span class="dot"></span>
          <span>Kinic</span>
        </div>
      </div>
      <button class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark mode">
        <span class="icon-moon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="16" height="16"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></span>
        <span class="icon-sun"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="16" height="16"><circle cx="12" cy="12" r="4"/><path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"/></svg></span>
      </button>
      <div class="badge coinbase">Built for AgentKit</div>
      <div class="badge base">Deployed on Base</div>
      <div class="badge live">Base Sepolia Live</div>
    </div>
  </header>

  <section class="hero">
    <div style="display: inline-block; background: linear-gradient(135deg, rgba(0,82,255,0.2), rgba(0,82,255,0.1)); border: 1px solid rgba(0,82,255,0.3); border-radius: 20px; padding: 6px 16px; margin-bottom: 16px;">
      <a href="https://docs.cdp.coinbase.com/agent-kit/core-concepts/architecture-explained#2-framework-extensions" target="_blank" style="color: var(--coinbase-blue); text-decoration: none; font-size: 13px; font-weight: 500;">
        AgentKit Framework Extension
      </a>
    </div>
    <h1>Trustless AgentKit</h1>
    <p>A <a href="https://docs.cdp.coinbase.com/agent-kit/welcome" target="_blank" style="color: var(--coinbase-blue);">Coinbase AgentKit</a> extension that adds cryptographic proofs to every agent action. Like <code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px;">agentkit-langchain</code>, but for trust.</p>

    <div class="pillars">
      <div class="pillar inference">
        <h3>Pillar 1: Verifiable Compute</h3>
        <h2>zkML Proofs</h2>
        <p>SNARK proves AI model ran correctly. Payment gates on proof verification.</p>
      </div>
      <div class="pillar memory">
        <h3>Pillar 2: Verifiable Memory</h3>
        <h2>Kinic + Base</h2>
        <p>AI memories on Kinic, Merkle commitments on Base. Full audit trail.</p>
      </div>
    </div>
  </section>

  <!-- Built With Section -->
  <section class="built-with">
    <h3>Extending the AgentKit Ecosystem</h3>
    <div class="logo-row">
      <a href="https://docs.cdp.coinbase.com/agent-kit/welcome" class="partner-logo" target="_blank">
        <div class="logo-icon-large" style="background: #0052FF; padding: 0; overflow: hidden;">
          <img src="https://cdn.iconscout.com/icon/free/png-512/free-coinbase-logo-icon-svg-download-png-7651204.png?f=webp&w=512" alt="AgentKit" style="width: 100%; height: 100%; object-fit: cover;">
        </div>
        <span>AgentKit</span>
      </a>
      <a href="https://base.org" class="partner-logo" target="_blank">
        <div class="logo-icon-large" style="background: #0052FF; padding: 0; overflow: hidden;">
          <img src="https://avatars.githubusercontent.com/u/108554348?s=200&v=4" alt="Base" style="width: 100%; height: 100%; object-fit: cover;">
        </div>
        <span>Base</span>
      </a>
      <a href="https://www.x402.org" class="partner-logo" target="_blank">
        <div class="logo-icon-large" style="background: #000; padding: 0; overflow: hidden;">
          <img src="https://www.x402.org/logos/x402-logo.png" alt="x402" style="width: 100%; height: 100%; object-fit: cover;">
        </div>
        <span>x402</span>
      </a>
      <a href="https://kinic.io" class="partner-logo" target="_blank">
        <div class="logo-icon-large" style="background: #000; padding: 0; overflow: hidden;">
          <img src="https://pbs.twimg.com/profile_images/1534479688948584450/daoq_bz8_400x400.jpg" alt="Kinic" style="width: 100%; height: 100%; object-fit: cover;">
        </div>
        <span>Kinic</span>
      </a>
      <a href="https://www.novanet.xyz/" class="partner-logo" target="_blank">
        <div class="logo-icon-large" style="background: #000; padding: 0; overflow: hidden;">
          <img src="https://pbs.twimg.com/profile_images/1759983864854839296/2KRImF8O_400x400.jpg" alt="NovaNet" style="width: 100%; height: 100%; object-fit: cover;">
        </div>
        <span>zkML</span>
      </a>
    </div>
  </section>

  <!-- Architecture Diagram -->
  <section class="architecture-section">
    <h2>How It Works</h2>
    <p class="subtitle">An <a href="https://docs.cdp.coinbase.com/agent-kit/core-concepts/architecture-explained#2-framework-extensions" target="_blank" style="color: var(--coinbase-blue);">AgentKit Framework Extension</a> for verifiable agent commerce</p>
    <div class="architecture-diagram">
      <div class="arch-row">
        <div class="arch-box agent">
          <h4>Agent A (Buyer)</h4>
          <p>CDP Wallet + AgentKit</p>
          <a href="https://sepolia.basescan.org/address/0xD1f2509993557a4f4AF729977732a9D3d4e7ff2E" target="_blank" style="font-family: 'JetBrains Mono', monospace; font-size: 9px; color: var(--coinbase-blue); margin-top: 8px; word-break: break-all; display: block; text-decoration: none;">
            0xD1f2509993557a4f4AF729977732a9D3d4e7ff2E
          </a>
          <div id="buyerUsdcBalance" style="font-size: 11px; color: var(--success-green); margin-top: 4px; font-weight: 500;">Loading...</div>
        </div>
        <div class="arch-arrow">→</div>
        <div class="arch-box trustless-layer">
          <h4>agentkit-guardrails</h4>
          <p style="font-size: 11px; color: var(--text-muted); margin-bottom: 8px;">Framework Extension</p>
          <div class="arch-pillars">
            <div class="arch-pillar zkml">
              <h5>Verifiable Compute</h5>
              <p>zkML proof gates payment</p>
            </div>
            <div class="arch-pillar memory">
              <h5>Verifiable Memory</h5>
              <p>Kinic stores, Base commits</p>
            </div>
          </div>
        </div>
        <div class="arch-arrow">→</div>
        <div class="arch-box agent">
          <h4>Agent B (Seller)</h4>
          <p>CDP Wallet + AgentKit</p>
          <a href="https://sepolia.basescan.org/address/0x1F11492041337F312465f2C63D09bda9e385b52a" target="_blank" style="font-family: 'JetBrains Mono', monospace; font-size: 9px; color: var(--coinbase-blue); margin-top: 8px; word-break: break-all; display: block; text-decoration: none;">
            0x1F11492041337F312465f2C63D09bda9e385b52a
          </a>
          <div id="sellerUsdcBalance" style="font-size: 11px; color: var(--success-green); margin-top: 4px; font-weight: 500;">Loading...</div>
        </div>
      </div>
      <div class="arch-row">
        <div class="arch-box kinic">
          <h4>Kinic (ICP)</h4>
          <p>AI Memory Layer • Stores inference I/O • zkML embeddings</p>
        </div>
        <div class="arch-arrow">↔</div>
        <div class="arch-box base">
          <h4>Base (Ethereum L2)</h4>
          <p>Merkle roots • zkML attestations • x402 payments</p>
        </div>
      </div>
    </div>
    <p style="text-align: center; color: var(--text-muted); font-size: 12px; margin-top: 16px;">
      Just like <code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px;">agentkit-langchain</code> wraps actions for LangChain,
      <code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px;">agentkit-guardrails</code> wraps actions with cryptographic proofs.
    </p>
  </section>

  <section class="demo-container">
    <div class="demo-header">
      <h2>Live A2A Transaction Demo</h2>
      <div class="demo-controls">
        <button class="btn btn-secondary" onclick="resetDemo()">Reset</button>
        <button class="btn btn-primary" onclick="runDemo()">
          <span>▶</span> Run Full Transaction
        </button>
        <details class="demo-description-dropdown" style="display: inline-block; vertical-align: middle;">
          <summary class="btn btn-secondary" style="cursor: pointer; list-style: none; display: inline-flex; align-items: center; gap: 6px; margin: 0;">
            <span class="info-arrow" style="transition: transform 0.2s; font-size: 10px;">▶</span> How it works
          </summary>
          <div style="position: absolute; left: 50%; transform: translateX(-50%); width: 600px; max-width: 90vw; text-align: left; padding: 16px; background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 8px; margin-top: 8px; z-index: 100; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
            <p style="margin-bottom: 12px;"><strong>Scenario:</strong> Agent A (DeFi trading bot) needs ETH market sentiment before executing a trade. Agent B (Sentiment Analyzer) offers this as a paid service.</p>
            <p style="margin-bottom: 12px;"><strong>The Problem:</strong> How does Agent A know Agent B actually ran an AI model and didn't just return a random answer to collect payment?</p>
            <p style="margin-bottom: 12px;"><strong>The Solution:</strong></p>
            <ol style="margin: 0 0 12px 20px; padding: 0;">
              <li style="margin-bottom: 6px;"><strong style="color: var(--warning-orange);">zkML Proof</strong> — Agent B runs inference inside a zkVM. The SNARK proof cryptographically proves the model ran correctly. <em>Payment only releases if proof verifies.</em></li>
              <li style="margin-bottom: 6px;"><strong style="color: var(--success-green);">Kinic Memory</strong> — Both the request ("What is ETH sentiment?") and the response ("bullish, 87% confidence") are stored as verifiable memories with Merkle proofs.</li>
              <li><strong style="color: var(--coinbase-blue);">x402 Payment</strong> — EIP-3009 USDC authorization is gated by proof verification. No valid proof = no payment.</li>
            </ol>
            <p style="font-size: 12px; color: var(--text-muted);"><strong>Key insight:</strong> The zkML proof acts as a guardrail — it's not just logging, it's the gate that controls whether Agent B gets paid. Fraud isn't just "risky" — it's cryptographically impossible.</p>
          </div>
        </details>
        <style>
          .demo-description-dropdown[open] .info-arrow { transform: rotate(90deg); }
          .demo-description-dropdown summary::-webkit-details-marker { display: none; }
        </style>
      </div>
    </div>

    <div class="workflow-grid">
      <!-- Agent Buyer Panel -->
      <div class="workflow-panel">
        <div class="panel-header">
          <div class="panel-icon blue"><span class="icon icon-lg"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="8" width="18" height="12" rx="2"/><circle cx="8" cy="14" r="1.5"/><circle cx="16" cy="14" r="1.5"/><path d="M9 4h6M12 4v4"/></svg></span></div>
          <div>
            <div class="panel-title">Agent A (Buyer)</div>
            <div class="panel-subtitle">Data Analysis Consumer</div>
          </div>
        </div>
        <div class="panel-content">
          <div class="agent-card">
            <div class="agent-header">
              <div class="agent-avatar buyer"><span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="7"/><path d="M21 21l-4.35-4.35"/></svg></span></div>
              <div class="agent-info">
                <h4>Market Research Agent</h4>
                <p>Agent ID: #1847 • CDP Wallet</p>
              </div>
            </div>
            <div class="agent-stats">
              <div class="stat">
                <div class="stat-value" style="color: var(--coinbase-blue);" id="demoBuyerBalance">--</div>
                <div class="stat-label">USDC Balance</div>
              </div>
              <div class="stat">
                <div class="stat-value">94</div>
                <div class="stat-label">Trust Score</div>
              </div>
              <div class="stat">
                <div class="stat-value">127</div>
                <div class="stat-label">Transactions</div>
              </div>
            </div>
          </div>

          <div class="tx-flow" id="buyerFlow">
            <div class="tx-step" id="step1">
              <div class="step-indicator"><span class="step-num">1</span></div>
              <div class="step-content">
                <h4>Semantic Agent Discovery</h4>
                <p>Kinic vector search finds agents by natural language</p>
                <div class="step-detail">
                  <code style="display: block; margin-bottom: 4px; color: var(--success-green);">kinic.search("ETH sentiment analysis")</code>
                  <code style="display: block; font-size: 10px; color: var(--text-muted);">→ Embedding query → Cosine similarity → Ranked results</code>
                </div>
                <div class="step-links" id="step1-links" style="display: none; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--glass-border);">
                  <div style="display: flex; gap: 12px; margin-bottom: 6px;">
                    <a href="https://dashboard.internetcomputer.org/canister/3tq5l-3iaaa-aaaak-apgva-cai" target="_blank" style="font-size: 11px; color: var(--success-green);">Kinic Canister →</a>
                    <a href="https://sepolia.basescan.org/address/0x406c7d97B0fdde58C078496fC153d0af9E972753#readContract" target="_blank" style="font-size: 11px; color: var(--coinbase-blue);">Identity Registry →</a>
                  </div>
                  <div style="font-size: 10px; color: var(--text-muted);" id="step1-result">
                    <span style="color: var(--success-green);">94.2% match</span> → Agent #2156 (Sentiment Analyzer)
                  </div>
                </div>
              </div>
            </div>
            <div class="tx-step" id="step2">
              <div class="step-indicator"><span class="step-num">2</span></div>
              <div class="step-content">
                <h4>Verify Agent via ERC-8004</h4>
                <p>Check identity, reputation, validation history</p>
                <div class="step-detail">
                  <code style="display: block; font-size: 10px;">IdentityRegistry.ownerOf(2156)</code>
                  <code style="display: block; font-size: 10px;">ReputationRegistry.getScore(2156)</code>
                  <code style="display: block; font-size: 10px;">ValidationRegistry.getProofCount(2156)</code>
                </div>
                <div class="step-links" id="step2-links" style="display: none; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--glass-border);">
                  <a href="https://sepolia.basescan.org/address/0x406c7d97B0fdde58C078496fC153d0af9E972753#readContract" target="_blank" style="font-size: 11px; color: var(--coinbase-blue);">Identity Registry →</a>
                  <a href="https://sepolia.basescan.org/address/0x94B536f4419F1B2704835d75cc5941E16cea06bD#readContract" target="_blank" style="font-size: 11px; color: var(--coinbase-blue); margin-left: 12px;">Reputation →</a>
                  <div style="font-size: 10px; color: var(--success-green); margin-top: 4px;">✓ Owner verified • Score: 97 • Proofs: 1,847</div>
                </div>
              </div>
            </div>
            <div class="tx-step" id="step3">
              <div class="step-indicator"><span class="step-num">3</span></div>
              <div class="step-content">
                <h4>Pay via x402 Protocol</h4>
                <p>HTTP micropayment with EIP-3009 USDC</p>
                <div class="step-detail">
                  <code style="display: block; font-size: 10px;">POST /api/analyze → 402 Payment Required</code>
                  <code style="display: block; font-size: 10px;">X-Payment: [EIP-3009 transferWithAuthorization]</code>
                </div>
                <div class="step-links" id="step3-links" style="display: none; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--glass-border);">
                  <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 4px;">
                    <a href="https://sepolia.basescan.org/address/0x036CbD53842c5426634e7929541eC2318f3dCF7e" target="_blank" style="color: var(--coinbase-blue);">USDC Contract →</a>
                  </div>
                  <div style="font-size: 10px; color: var(--text-muted);">
                    Buyer: <a href="https://sepolia.basescan.org/address/0xD1f2509993557a4f4AF729977732a9D3d4e7ff2E" target="_blank" style="color: var(--coinbase-blue);">0xD1f2...ff2E</a>
                    → Seller: <a href="https://sepolia.basescan.org/address/0x1F11492041337F312465f2C63D09bda9e385b52a" target="_blank" style="color: var(--coinbase-blue);">0x1F11...b52a</a>
                  </div>
                  <div style="font-size: 10px; color: var(--success-green); margin-top: 4px;" id="step3-result">Amount: 0.05 USDC • EIP-3009 signature</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Agent Seller Panel -->
      <div class="workflow-panel">
        <div class="panel-header">
          <div class="panel-icon green"><span class="icon icon-lg"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="8" width="18" height="12" rx="2"/><circle cx="8" cy="14" r="1.5"/><circle cx="16" cy="14" r="1.5"/><path d="M9 4h6M12 4v4"/></svg></span></div>
          <div>
            <div class="panel-title">Agent B (Seller)</div>
            <div class="panel-subtitle">Data Analysis Provider</div>
          </div>
        </div>
        <div class="panel-content">
          <div class="agent-card">
            <div class="agent-header">
              <div class="agent-avatar seller"><span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 3v18h18"/><path d="M7 14l4-4 4 4 5-5"/></svg></span></div>
              <div class="agent-info">
                <h4>Sentiment Analysis Agent</h4>
                <p>Agent ID: #2156 • CDP Wallet</p>
              </div>
            </div>
            <div class="agent-stats">
              <div class="stat">
                <div class="stat-value" style="color: var(--success-green);" id="demoSellerBalance">--</div>
                <div class="stat-label">USDC Balance</div>
              </div>
              <div class="stat">
                <div class="stat-value">97</div>
                <div class="stat-label">Trust Score</div>
              </div>
              <div class="stat">
                <div class="stat-value">1,847</div>
                <div class="stat-label">Proofs Posted</div>
              </div>
            </div>
          </div>

          <div class="tx-flow" id="sellerFlow">
            <div class="tx-step" id="step4">
              <div class="step-indicator"><span class="step-num">4</span></div>
              <div class="step-content">
                <h4>Run AI Inference in zkVM</h4>
                <p>Execute sentiment model with Jolt Atlas</p>
                <div class="step-detail">
                  <code style="display: block; font-size: 10px;">POST http://localhost:3001/prove</code>
                  <code style="display: block; font-size: 10px; color: var(--text-muted);">{ model: "sentiment-v2", input: "ETH 24h data..." }</code>
                </div>
                <div class="step-links" id="step4-links" style="display: none; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--glass-border);">
                  <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 4px;">
                    <a href="https://github.com/ICME-Lab/jolt-atlas" target="_blank" style="color: var(--warning-orange);">Jolt Atlas zkML Prover →</a>
                  </div>
                  <div style="font-size: 10px; color: var(--text-muted);">
                    Model Hash: <span id="step4-model" style="font-family: 'JetBrains Mono', monospace; color: var(--coinbase-blue);">0x8f3a...2d1e</span>
                  </div>
                  <div style="font-size: 10px; color: var(--text-muted); margin-top: 2px;">
                    Input Hash: <span id="step4-input" style="font-family: 'JetBrains Mono', monospace; color: var(--coinbase-blue);">0x4b2c...9f7a</span>
                  </div>
                  <div style="font-size: 10px; color: var(--success-green); margin-top: 4px;">⏱ Proving time: ~2.4s (Jolt Atlas)</div>
                </div>
              </div>
            </div>
            <div class="tx-step" id="step5">
              <div class="step-indicator"><span class="step-num">5</span></div>
              <div class="step-content">
                <h4>Return Result + zkML Proof</h4>
                <p>Cryptographic proof of correct inference</p>
                <div class="step-detail">
                  <code style="display: block; font-size: 10px;">Result: { sentiment: "bullish", confidence: 0.87 }</code>
                  <code style="display: block; font-size: 10px; color: var(--text-muted);">SNARK proof generated and verified</code>
                </div>
                <div class="step-links" id="step5-links" style="display: none; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--glass-border);">
                  <div style="font-size: 10px; color: var(--text-muted);">
                    Output Hash: <span id="step5-output" style="font-family: 'JetBrains Mono', monospace; color: var(--coinbase-blue);">0x9e7d...3a4f</span>
                  </div>
                  <div style="font-size: 10px; color: var(--text-muted); margin-top: 2px;">
                    Proof: <span id="step5-proof" style="font-family: 'JetBrains Mono', monospace; color: var(--warning-orange);">0x7a8f...3d2e</span>
                  </div>
                  <div style="font-size: 10px; color: var(--text-muted); margin-top: 2px;">
                    Proving time: <span id="step5-time" style="font-family: 'JetBrains Mono', monospace; color: var(--success-green);">~2.4s</span> (Jolt Atlas)
                  </div>
                  <div style="font-size: 10px; color: var(--success-green); margin-top: 4px;">✓ Proof verified locally</div>
                </div>
              </div>
            </div>
            <div class="tx-step" id="step6">
              <div class="step-indicator"><span class="step-num">6</span></div>
              <div class="step-content">
                <h4>Store: Compute + Memory</h4>
                <p>zkML attestation to Base, AI memory to Kinic</p>
                <div class="step-detail" style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                  <div style="background: rgba(245,158,11,0.1); padding: 6px; border-radius: 4px; border-left: 2px solid var(--warning-orange);">
                    <div style="font-size: 9px; color: var(--warning-orange); font-weight: 500; margin-bottom: 2px;">COMPUTE (zkML)</div>
                    <code style="font-size: 9px;">ValidationRegistry.post(proof)</code>
                  </div>
                  <div style="background: rgba(0,214,50,0.1); padding: 6px; border-radius: 4px; border-left: 2px solid var(--success-green);">
                    <div style="font-size: 9px; color: var(--success-green); font-weight: 500; margin-bottom: 2px;">MEMORY (Kinic)</div>
                    <code style="font-size: 9px;">Kinic.insert(output)</code>
                  </div>
                </div>
                <div class="step-links" id="step6-links" style="display: none; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--glass-border);">
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 6px;">
                    <div>
                      <div style="font-size: 9px; color: var(--warning-orange); margin-bottom: 2px;">zkML Proof Attestation:</div>
                      <a href="https://sepolia.basescan.org/address/0xc4e7c6304f0ab160620d6b7f42d0cadf576b0d81" target="_blank" style="font-size: 10px; color: var(--coinbase-blue);">ValidationRegistry →</a>
                      <div style="font-size: 10px; color: var(--text-muted); margin-top: 2px;" id="step6-tx">
                        <a href="#" id="step6-tx-link" target="_blank" style="color: var(--coinbase-blue);">Pending...</a>
                      </div>
                    </div>
                    <div>
                      <div style="font-size: 9px; color: var(--success-green); margin-bottom: 2px;">AI Memory Storage:</div>
                      <a href="https://dashboard.internetcomputer.org/canister/3tq5l-3iaaa-aaaak-apgva-cai" target="_blank" style="font-size: 10px; color: var(--success-green);">Kinic Canister →</a>
                      <div style="font-size: 10px; color: var(--text-muted); margin-top: 2px;">
                        Root: <span id="step6-merkle" style="font-family: 'JetBrains Mono', monospace; color: var(--success-green);">0x3f2a...8b1c</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </section>

  <!-- The Two Pillars: Verifiable Compute + Verifiable Memory -->
  <section class="onchain-registry-section" style="padding: 48px 24px; max-width: 1200px; margin: 0 auto;">
    <h2 style="text-align: center; margin-bottom: 8px;">The Two Pillars of Trust</h2>
    <p class="subtitle" style="text-align: center; margin-bottom: 32px;">Verifiable Compute (zkML) + Verifiable Memory (Kinic)</p>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px;">
      <!-- Left Column: Verifiable Compute (zkML + Base) -->
      <div class="compute-column">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--glass-border);">
          <span class="icon icon-lg" style="opacity: 0.5;"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg></span>
          <h3 style="margin: 0; font-size: 18px;">Verifiable Compute</h3>
          <span style="font-size: 12px; color: var(--warning-orange); background: rgba(245,158,11,0.1); padding: 2px 8px; border-radius: 10px;">zkML</span>
        </div>

        <div style="background: linear-gradient(135deg, rgba(245,158,11,0.05), rgba(0,82,255,0.05)); border: 1px solid var(--warning-orange); border-radius: 8px; padding: 16px; margin-bottom: 16px;">
          <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">
            <strong>What it proves:</strong> "This AI model ran correctly with these inputs and produced this output"
          </div>
          <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            <span style="font-size: 10px; background: rgba(245,158,11,0.1); color: var(--warning-orange); padding: 4px 8px; border-radius: 4px;">SNARK Proofs</span>
            <span style="font-size: 10px; background: rgba(245,158,11,0.1); color: var(--warning-orange); padding: 4px 8px; border-radius: 4px;">Model Commitment</span>
            <span style="font-size: 10px; background: rgba(245,158,11,0.1); color: var(--warning-orange); padding: 4px 8px; border-radius: 4px;">Input/Output Hashes</span>
          </div>
        </div>

        <!-- Jolt Atlas Prover -->
        <div class="contract-item" style="background: var(--card-bg); border: 1px solid var(--warning-orange); border-radius: 8px; padding: 14px; margin-bottom: 10px;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <span>🔮</span>
              <span style="font-weight: 500;">Jolt Atlas Prover</span>
            </div>
            <span style="font-size: 10px; color: var(--warning-orange); background: rgba(245,158,11,0.1); padding: 2px 6px; border-radius: 4px;">zkVM</span>
          </div>
          <code style="font-size: 10px; color: var(--text-muted); display: block; margin-bottom: 6px;">localhost:3001 (Rust service)</code>
          <a href="https://github.com/ICME-Lab/jolt-atlas" target="_blank" style="color: var(--warning-orange); font-size: 11px;">View Jolt Atlas →</a>
        </div>

        <!-- Validation Registry -->
        <div class="contract-item" style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 8px; padding: 14px; margin-bottom: 10px;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <span>🔐</span>
              <span style="font-weight: 500;">Validation Registry</span>
            </div>
            <span style="font-size: 10px; color: var(--coinbase-blue); background: rgba(0,82,255,0.1); padding: 2px 6px; border-radius: 4px;">Base</span>
          </div>
          <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 6px;">Stores zkML proof attestations on-chain</div>
          <code style="font-size: 10px; color: var(--text-muted); display: block; margin-bottom: 6px;">0xc4e7c6304f0ab160620d6b7f42d0cadf576b0d81</code>
          <a href="https://sepolia.basescan.org/address/0xc4e7c6304f0ab160620d6b7f42d0cadf576b0d81#code" target="_blank" style="color: var(--coinbase-blue); font-size: 11px;">View on BaseScan →</a>
        </div>

        <!-- Identity Registry -->
        <div class="contract-item" style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 8px; padding: 14px; margin-bottom: 10px;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <span>🆔</span>
              <span style="font-weight: 500;">Identity Registry</span>
            </div>
            <span style="font-size: 10px; color: var(--coinbase-blue); background: rgba(0,82,255,0.1); padding: 2px 6px; border-radius: 4px;">ERC-8004</span>
          </div>
          <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 6px;">Agent NFT identities</div>
          <code style="font-size: 10px; color: var(--text-muted); display: block; margin-bottom: 6px;">0x406c7d97B0fdde58C078496fC153d0af9E972753</code>
          <a href="https://sepolia.basescan.org/address/0x406c7d97B0fdde58C078496fC153d0af9E972753#code" target="_blank" style="color: var(--coinbase-blue); font-size: 11px;">View on BaseScan →</a>
        </div>

        <!-- Reputation Registry -->
        <div class="contract-item" style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 8px; padding: 14px;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <span>⭐</span>
              <span style="font-weight: 500;">Reputation Registry</span>
            </div>
            <span style="font-size: 10px; color: var(--coinbase-blue); background: rgba(0,82,255,0.1); padding: 2px 6px; border-radius: 4px;">Base</span>
          </div>
          <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 6px;">Trust scores from verified transactions</div>
          <code style="font-size: 10px; color: var(--text-muted); display: block; margin-bottom: 6px;">0x94B536f4419F1B2704835d75cc5941E16cea06bD</code>
          <a href="https://sepolia.basescan.org/address/0x94B536f4419F1B2704835d75cc5941E16cea06bD#code" target="_blank" style="color: var(--coinbase-blue); font-size: 11px;">View on BaseScan →</a>
        </div>
      </div>

      <!-- Right Column: Verifiable Memory (Kinic) -->
      <div class="memory-column">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--glass-border);">
          <span class="icon icon-lg" style="opacity: 0.5;"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7z"/><path d="M9 21h6M10 17v4M14 17v4"/></svg></span>
          <h3 style="margin: 0; font-size: 18px;">Verifiable Memory</h3>
          <span style="font-size: 12px; color: var(--success-green); background: rgba(0,214,50,0.1); padding: 2px 8px; border-radius: 10px;">Kinic</span>
        </div>

        <div style="background: linear-gradient(135deg, rgba(0,214,50,0.05), rgba(0,82,255,0.05)); border: 1px solid var(--success-green); border-radius: 8px; padding: 16px; margin-bottom: 16px;">
          <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px;">
            <strong>What it stores:</strong> "The AI generated this output, learned this, decided this — with Merkle proof"
          </div>
          <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            <span style="font-size: 10px; background: rgba(0,214,50,0.1); color: var(--success-green); padding: 4px 8px; border-radius: 4px;">Inference Outputs</span>
            <span style="font-size: 10px; background: rgba(0,214,50,0.1); color: var(--success-green); padding: 4px 8px; border-radius: 4px;">Decision History</span>
            <span style="font-size: 10px; background: rgba(0,214,50,0.1); color: var(--success-green); padding: 4px 8px; border-radius: 4px;">Learning Memories</span>
          </div>
        </div>

        <!-- Kinic Canister -->
        <div class="contract-item" style="background: var(--card-bg); border: 1px solid var(--success-green); border-radius: 8px; padding: 14px; margin-bottom: 10px;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <span>🌐</span>
              <span style="font-weight: 500;">Kinic Memory Canister</span>
            </div>
            <span style="font-size: 10px; color: var(--success-green); background: rgba(0,214,50,0.1); padding: 2px 6px; border-radius: 4px;">ICP</span>
          </div>
          <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 6px;">On-chain vector DB with zkML embeddings</div>
          <code style="font-size: 10px; color: var(--text-muted); display: block; margin-bottom: 6px;">3tq5l-3iaaa-aaaak-apgva-cai</code>
          <a href="https://dashboard.internetcomputer.org/canister/3tq5l-3iaaa-aaaak-apgva-cai" target="_blank" style="color: var(--success-green); font-size: 11px;">View on IC Dashboard →</a>
        </div>

        <!-- Memory Registry -->
        <div class="contract-item" style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 8px; padding: 14px; margin-bottom: 10px;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <span class="icon icon-sm" style="opacity: 0.5;"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 22V8M12 8l-4 4M12 8l4 4"/><circle cx="12" cy="5" r="3"/></svg></span>
              <span style="font-weight: 500;">Memory Registry</span>
            </div>
            <span style="font-size: 10px; color: var(--coinbase-blue); background: rgba(0,82,255,0.1); padding: 2px 6px; border-radius: 4px;">Base</span>
          </div>
          <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 6px;">Merkle root commitments for memory integrity</div>
          <code style="font-size: 10px; color: var(--text-muted); display: block; margin-bottom: 6px;">0x433bdba4717e7cb74551a4fcb47e2459670c2e1b</code>
          <a href="https://sepolia.basescan.org/address/0x433bdba4717e7cb74551a4fcb47e2459670c2e1b#code" target="_blank" style="color: var(--coinbase-blue); font-size: 11px;">View on BaseScan →</a>
        </div>

        <!-- Live Memory Feed -->
        <div class="contract-item" style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 8px; padding: 14px; margin-bottom: 10px;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <span class="icon icon-sm" style="opacity: 0.5;"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg></span>
              <span style="font-weight: 500;">AI Memory Feed</span>
            </div>
            <span style="font-size: 10px; color: var(--text-muted); background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px;">Live</span>
          </div>
          <div id="live-memory-feed" style="font-size: 10px; color: var(--text-muted); max-height: 120px; overflow-y: auto;">
            <div style="padding: 4px 0; border-bottom: 1px solid var(--glass-border);">Waiting for demo to run...</div>
          </div>
          <a href="https://dashboard.internetcomputer.org/canister/3tq5l-3iaaa-aaaak-apgva-cai" target="_blank" style="color: var(--coinbase-blue); font-size: 11px; display: inline-block; margin-top: 8px;">View Kinic Canister on IC →</a>
        </div>

        <!-- Current Merkle Root -->
        <div class="contract-item" style="background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 8px; padding: 14px;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <span class="icon icon-sm" style="opacity: 0.5;"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg></span>
              <span style="font-weight: 500;">Current Merkle Root</span>
            </div>
            <span id="pillar-merkle-status" style="font-size: 10px; color: var(--success-green);">0 memories</span>
          </div>
          <code id="pillar-merkle-root" onclick="copyMerkleRoot()" style="font-size: 10px; color: var(--success-green); display: block; word-break: break-all; cursor: pointer; transition: background 0.2s;" title="Click to copy">0x0000000000000000000000000000000000000000000000000000000000000000</code>
          <div style="font-size: 10px; color: var(--text-muted); margin-top: 6px;">
            Data stored in Kinic • Root committed to Base
          </div>
          <a href="https://sepolia.basescan.org/address/0x433bdba4717e7cb74551a4fcb47e2459670c2e1b" target="_blank" style="color: var(--coinbase-blue); font-size: 11px; display: inline-block; margin-top: 8px;">View Memory Registry on BaseScan →</a>
        </div>
      </div>
    </div>

    <!-- Merkle Tree Visualization -->
    <div style="margin-top: 24px; background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 24px;">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
        <h4 style="margin: 0; display: flex; align-items: center; gap: 8px;">
          <span class="icon icon-sm" style="opacity: 0.5;"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 22V8M12 8l-4 4M12 8l4 4"/><circle cx="12" cy="5" r="3"/></svg></span> Merkle Tree Structure
        </h4>
        <div style="display: flex; align-items: center; gap: 12px;">
          <span id="tree-depth" style="font-size: 10px; color: var(--text-muted);">Depth: 0</span>
          <span id="tree-leaves-count" style="font-size: 10px; color: var(--success-green);">0 leaves</span>
        </div>
      </div>

      <!-- Tree Visualization Container -->
      <div id="merkleTreeViz" class="merkle-tree" style="min-height: 120px; display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 16px; background: rgba(0,0,0,0.2); border-radius: 8px; overflow-x: auto;">
        <div class="merkle-level">
          <div class="merkle-node root" style="opacity: 0.5;">Root: (empty)</div>
        </div>
      </div>

      <!-- Legend -->
      <div style="display: flex; justify-content: center; gap: 24px; margin-top: 16px; font-size: 10px; color: var(--text-muted);">
        <div style="display: flex; align-items: center; gap: 6px;">
          <div style="width: 12px; height: 12px; background: var(--coinbase-blue); border-radius: 4px;"></div>
          <span>Root (committed to Base)</span>
        </div>
        <div style="display: flex; align-items: center; gap: 6px;">
          <div style="width: 12px; height: 12px; background: rgba(255,255,255,0.2); border-radius: 4px;"></div>
          <span>Internal nodes</span>
        </div>
        <div style="display: flex; align-items: center; gap: 6px;">
          <div style="width: 12px; height: 12px; background: var(--success-green); border-radius: 4px;"></div>
          <span>Leaves (memories)</span>
        </div>
      </div>

      <!-- How it works -->
      <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--glass-border);">
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; font-size: 11px; color: var(--text-secondary);">
          <div style="text-align: center;">
            <div style="font-size: 20px; margin-bottom: 4px;">📥</div>
            <strong>Insert Memory</strong>
            <div style="font-size: 10px; color: var(--text-muted); margin-top: 4px;">Hash content → add leaf → recalculate path to root</div>
          </div>
          <div style="text-align: center;">
            <div style="margin-bottom: 4px;"><span class="icon icon-md" style="opacity: 0.5;"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="7"/><path d="M21 21l-4.35-4.35"/></svg></span></div>
            <strong>Generate Proof</strong>
            <div style="font-size: 10px; color: var(--text-muted); margin-top: 4px;">O(log n) sibling hashes needed to verify any leaf</div>
          </div>
          <div style="text-align: center;">
            <div style="font-size: 20px; margin-bottom: 4px;">✅</div>
            <strong>Verify Inclusion</strong>
            <div style="font-size: 10px; color: var(--text-muted); margin-top: 4px;">Recompute root from leaf + proof → compare to committed root</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Two Pillars Explanation -->
    <div style="margin-top: 32px; background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 12px; padding: 24px;">
      <h4 style="margin: 0 0 16px 0; text-align: center;">Why Both Pillars?</h4>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; font-size: 12px; color: var(--text-secondary);">
        <div>
          <strong style="color: var(--warning-orange);">zkML alone:</strong> Proves the model ran correctly <em>now</em>, but says nothing about the context it used. An agent could prove correct inference while using fabricated memories.
        </div>
        <div>
          <strong style="color: var(--success-green);">Kinic alone:</strong> Proves data wasn't tampered with, but says nothing about how it was processed. An agent could store memories but produce unverified outputs.
        </div>
      </div>
      <div style="text-align: center; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--glass-border);">
        <strong>Together:</strong> Verified memories feed into verified inference → end-to-end auditable chain from stored knowledge to final decision.
      </div>
    </div>
  </section>

  <!-- x402 Protocol Section -->
  <section class="contracts-section" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(0, 82, 255, 0.05));">
    <h2>x402: HTTP Micropayments</h2>
    <p class="subtitle">Pay-per-API-call using EIP-3009 USDC authorizations</p>
    <div class="contracts-grid" style="grid-template-columns: repeat(3, 1fr);">
      <div class="contract-card">
        <div class="icon">📨</div>
        <h4>1. Request Resource</h4>
        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 12px;">
          Agent A sends HTTP request to Agent B's API endpoint
        </div>
        <div style="font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--text-muted); background: rgba(0,0,0,0.2); padding: 8px; border-radius: 6px;">
          POST /api/analyze<br>
          Content-Type: application/json
        </div>
      </div>
      <div class="contract-card">
        <div class="icon">💳</div>
        <h4>2. Payment Required</h4>
        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 12px;">
          Server returns 402 with payment details in X-Payment-Required header
        </div>
        <div style="font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--text-muted); background: rgba(0,0,0,0.2); padding: 8px; border-radius: 6px;">
          HTTP/1.1 402 Payment Required<br>
          X-Payment-Required: {...}
        </div>
      </div>
      <div class="contract-card">
        <div class="icon">✅</div>
        <h4>3. Pay & Access</h4>
        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 12px;">
          Client retries with EIP-3009 signed USDC authorization
        </div>
        <div style="font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--text-muted); background: rgba(0,0,0,0.2); padding: 8px; border-radius: 6px;">
          POST /api/analyze<br>
          X-Payment: [EIP-3009]
        </div>
      </div>
    </div>
    <div style="text-align: center; margin-top: 24px;">
      <a href="https://github.com/coinbase/x402" target="_blank" class="btn btn-secondary" style="display: inline-flex;">
        <span>📖</span> View x402 Specification
      </a>
    </div>
  </section>

  <!-- Comparison Table Section -->
  <section class="comparison-section">
    <h2>AgentKit vs Trustless AgentKit</h2>
    <p class="subtitle">What makes agent interactions verifiable and trustless</p>

    <table class="comparison-table">
      <thead>
        <tr>
          <th class="feature">Feature</th>
          <th>AgentKit</th>
          <th class="highlight-col">Trustless AgentKit</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="feature">Agent Wallets (CDP)</td>
          <td class="check">✓</td>
          <td class="highlight-col check">✓</td>
        </tr>
        <tr>
          <td class="feature">On-chain Transactions</td>
          <td class="check">✓</td>
          <td class="highlight-col check">✓</td>
        </tr>
        <tr>
          <td class="feature">Verifiable AI Inference (zkML)</td>
          <td class="cross">✗</td>
          <td class="highlight-col check">✓</td>
        </tr>
        <tr>
          <td class="feature">Verifiable Memory (Merkle)</td>
          <td class="cross">✗</td>
          <td class="highlight-col check">✓</td>
        </tr>
        <tr>
          <td class="feature">Fraud Prevention</td>
          <td class="cross">✗</td>
          <td class="highlight-col check">✓</td>
        </tr>
        <tr>
          <td class="feature">On-chain Audit Trail</td>
          <td class="cross">✗</td>
          <td class="highlight-col check">✓</td>
        </tr>
        <tr>
          <td class="feature">Agent-to-Agent Trust</td>
          <td class="cross">✗</td>
          <td class="highlight-col check">✓</td>
        </tr>
        <tr>
          <td class="feature">Semantic Agent Discovery</td>
          <td class="cross">✗</td>
          <td class="highlight-col check">✓</td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- Why Verifiability Matters Section -->
  <section class="demo-container" style="padding-top: 40px;">
    <div class="workflow-panel attack-panel" style="max-width: 900px; margin: 0 auto;">
      <div class="panel-header">
        <div class="panel-icon" style="background: rgba(255, 59, 48, 0.2);"><span class="icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 9v4M12 17h.01"/><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/></svg></span></div>
        <div>
          <div class="panel-title">Why Verifiability Matters</div>
          <div class="panel-subtitle">The attack Trustless AgentKit prevents</div>
        </div>
      </div>
      <div class="panel-content">
        <div class="attack-scenario">
          <div class="scenario-box without">
            <h4><span style="color: var(--error-red);">✗</span> Without Trustless AgentKit</h4>
            <ul>
              <li>Agent claims to run sentiment model</li>
              <li>Actually returns hardcoded "bullish" response</li>
              <li>Buyer pays for fake analysis</li>
              <li>No way to detect fraud</li>
              <li>No recourse after payment</li>
            </ul>
          </div>
          <div class="scenario-box with">
            <h4><span style="color: var(--success-green);">✓</span> With Trustless AgentKit</h4>
            <ul>
              <li>Agent must run model in zkVM</li>
              <li>SNARK proves exact model executed</li>
              <li>Proof verified before payment released</li>
              <li>Fraud cryptographically impossible</li>
              <li>Full audit trail on Base</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="stats-bar">
    <div class="stats-item">
      <div class="value">~2.4s</div>
      <div class="label">Proof Generation</div>
    </div>
    <div class="stats-item">
      <div class="value">~200ms</div>
      <div class="label">Kinic Search</div>
    </div>
    <div class="stats-item">
      <div class="value">$0.001</div>
      <div class="label">Per Transaction (Base)</div>
    </div>
    <div class="stats-item">
      <div class="value">∞</div>
      <div class="label">Scalable Agents</div>
    </div>
  </div>

  <!-- Real Services Info -->
  <section style="padding: 24px 48px; text-align: center; border-top: 1px solid var(--glass-border);">
    <div style="display: inline-flex; gap: 24px; align-items: center; flex-wrap: wrap; justify-content: center;">
      <div style="font-size: 13px; color: var(--text-secondary);">
        <strong style="color: var(--text-primary);">This demo connects to real services:</strong>
      </div>
      <div style="display: flex; gap: 16px; font-size: 12px;">
        <span style="display: flex; align-items: center; gap: 6px;">
          <span style="width: 8px; height: 8px; border-radius: 50%; background: var(--coinbase-blue);"></span>
          Prover: localhost:3001 (Jolt Atlas)
        </span>
        <span style="display: flex; align-items: center; gap: 6px;">
          <span style="width: 8px; height: 8px; border-radius: 50%; background: var(--success-green);"></span>
          Kinic: localhost:3002 → IC
        </span>
        <span style="display: flex; align-items: center; gap: 6px;">
          <span style="width: 8px; height: 8px; border-radius: 50%; background: var(--warning-orange);"></span>
          Contracts: Base Sepolia
        </span>
      </div>
    </div>
  </section>

  <footer>
    <div class="footer-links">
      <a href="https://github.com/hshadab/coinbase">GitHub</a>
      <a href="https://docs.cdp.coinbase.com/agent-kit/welcome">AgentKit Docs</a>
      <a href="https://github.com/coinbase/x402">x402 Protocol</a>
      <a href="https://kinic.io">Kinic</a>
      <a href="https://base.org">Base</a>
    </div>
    <div class="footer-tagline">
      <strong>Verifiable Inference + Verifiable Memory = Trustless Agents</strong>
    </div>
  </footer>

  <!-- Ethers.js for real wallet operations -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.9.0/ethers.umd.min.js"></script>

  <script>
    let currentStep = 0;
    let demoInterval = null;
    let registeredModelId = null;
    let servicesReady = { prover: false, kinic: false };

    // Service endpoints
    const PROVER_URL = 'http://localhost:3001';
    const KINIC_URL = 'http://localhost:3002';
    const BASE_RPC = 'https://sepolia.base.org';

    // USDC contract on Base Sepolia
    const USDC_ADDRESS = '0x036CbD53842c5426634e7929541eC2318f3dCF7e';
    const USDC_DECIMALS = 6;

    // Deployed contract addresses (Base Sepolia) - from forge broadcast
    const CONTRACTS = {
      memoryRegistry: '0x433bdBa4717e7CB74551A4FCB47E2459670c2e1B',
      identityRegistry: '0x406c7d97B0fdde58C078496fC153d0af9E972753',
      reputationRegistry: '0x94B536f4419F1B2704835d75cc5941E16cea06bD',
      attestationRegistry: '0x95B605dB1cdF6c9a1AF7E0db8c127b83d514858e',
      validationRegistry: '0xc4e7c6304f0ab160620d6b7f42d0cadf576b0d81',
      agentEscrow: '0x8fcaf0ac3e0a75d3e3f04c9035fff51dfed56a6c',
      chainId: 84532
    };

    // =========================================================================
    // DEMO AGENT WALLETS - Real wallets for x402/USDC transfers
    // These are deterministic wallets derived from known seeds for demo purposes
    // In production, agents would have CDP MPC wallets or hardware-backed keys
    // =========================================================================

    // Demo wallet private keys (Base Sepolia testnet only!)
    // WARNING: These are PUBLIC demo keys - never use for real funds
    const DEMO_WALLETS = {
      buyer: {
        // Agent A (Buyer) - requests data, pays USDC
        privateKey: '0x22cee7016e814342c0377293a8708edc3365cde60d7a336b27daae143181fbd8',
        name: 'Agent A (Buyer)',
        description: 'Data consumer - pays for sentiment analysis'
      },
      seller: {
        // Agent B (Seller) - provides data, receives USDC
        privateKey: '0x769c171a07b224f88897eea98b850bf1c1e905f5c06fb7138c0985a6808e4787',
        name: 'Agent B (Seller)',
        description: 'Sentiment analyzer - provides ML inference'
      }
    };

    // Live Agent wallet addresses (Foundry deterministic accounts 2-6)
    const AGENT_WALLETS = {
      'sentiment-analyzer': '0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC',
      'defi-trading-bot': '0x90F79bf6EB2c4f870365E785982E1f101E93b906',
      'market-data-feed': '0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65',
      'risk-assessor': '0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc',
      'nft-valuator': '0x976EA74026E726554dB657fA54763abd0C3a0aa9'
    };

    // Store agent balances
    let agentBalances = {};

    // Initialize agent wallets
    let agentWallets = { buyer: null, seller: null };
    let provider = null;

    async function initializeWallets() {
      try {
        provider = new ethers.JsonRpcProvider(BASE_RPC);

        // Create wallet instances
        agentWallets.buyer = new ethers.Wallet(DEMO_WALLETS.buyer.privateKey, provider);
        agentWallets.seller = new ethers.Wallet(DEMO_WALLETS.seller.privateKey, provider);

        console.log('Demo wallets initialized:');
        console.log(`  Buyer:  ${agentWallets.buyer.address}`);
        console.log(`  Seller: ${agentWallets.seller.address}`);

        // Check USDC balances
        await updateWalletBalances();

        return true;
      } catch (e) {
        console.error('Failed to initialize wallets:', e.message);
        return false;
      }
    }

    async function updateWalletBalances() {
      if (!agentWallets.buyer || !agentWallets.seller) return;

      const usdcAbi = ['function balanceOf(address) view returns (uint256)'];
      const usdc = new ethers.Contract(USDC_ADDRESS, usdcAbi, provider);

      try {
        const [buyerBalance, sellerBalance] = await Promise.all([
          usdc.balanceOf(agentWallets.buyer.address),
          usdc.balanceOf(agentWallets.seller.address)
        ]);

        agentWallets.buyer.usdcBalance = ethers.formatUnits(buyerBalance, USDC_DECIMALS);
        agentWallets.seller.usdcBalance = ethers.formatUnits(sellerBalance, USDC_DECIMALS);

        console.log('USDC Balances:');
        console.log(`  Buyer:  ${agentWallets.buyer.usdcBalance} USDC`);
        console.log(`  Seller: ${agentWallets.seller.usdcBalance} USDC`);

        // Update UI if elements exist
        const buyerBalanceEl = document.getElementById('buyerUsdcBalance');
        const sellerBalanceEl = document.getElementById('sellerUsdcBalance');
        const demoBuyerBalanceEl = document.getElementById('demoBuyerBalance');
        const demoSellerBalanceEl = document.getElementById('demoSellerBalance');
        if (buyerBalanceEl) buyerBalanceEl.textContent = `${agentWallets.buyer.usdcBalance} USDC`;
        if (sellerBalanceEl) sellerBalanceEl.textContent = `${agentWallets.seller.usdcBalance} USDC`;
        if (demoBuyerBalanceEl) demoBuyerBalanceEl.textContent = `${parseFloat(agentWallets.buyer.usdcBalance).toFixed(2)} USDC`;
        if (demoSellerBalanceEl) demoSellerBalanceEl.textContent = `${parseFloat(agentWallets.seller.usdcBalance).toFixed(2)} USDC`;
      } catch (e) {
        console.log('Could not fetch USDC balances:', e.message);
      }
    }

    // Fetch and display balances for all Live Agents
    async function updateAgentBalances() {
      if (!provider) return;

      const usdcAbi = ['function balanceOf(address) view returns (uint256)'];
      const usdc = new ethers.Contract(USDC_ADDRESS, usdcAbi, provider);

      for (const [agentId, address] of Object.entries(AGENT_WALLETS)) {
        try {
          const balance = await usdc.balanceOf(address);
          const formattedBalance = ethers.formatUnits(balance, USDC_DECIMALS);
          agentBalances[agentId] = formattedBalance;

          // Update UI element if it exists
          const balanceEl = document.getElementById(`balance-${agentId}`);
          if (balanceEl) {
            balanceEl.textContent = `${parseFloat(formattedBalance).toFixed(2)} USDC`;
          }
        } catch (e) {
          console.log(`Could not fetch balance for ${agentId}:`, e.message);
        }
      }
    }

    // EIP-3009 domain and types for USDC transferWithAuthorization
    // Note: Base Sepolia testnet USDC uses "USDC" as domain name (not "USD Coin" like mainnet)
    const EIP3009_DOMAIN = {
      name: 'USDC',
      version: '2',
      chainId: 84532, // Base Sepolia
      verifyingContract: USDC_ADDRESS
    };

    const TRANSFER_WITH_AUTHORIZATION_TYPES = {
      TransferWithAuthorization: [
        { name: 'from', type: 'address' },
        { name: 'to', type: 'address' },
        { name: 'value', type: 'uint256' },
        { name: 'validAfter', type: 'uint256' },
        { name: 'validBefore', type: 'uint256' },
        { name: 'nonce', type: 'bytes32' },
      ]
    };

    // Simple keccak256 implementation for browser
    async function keccak256(data) {
      // Use SubtleCrypto for SHA-256 as approximation, or load ethers
      const encoder = new TextEncoder();
      const dataBytes = typeof data === 'string' ? encoder.encode(data) : data;
      const hashBuffer = await crypto.subtle.digest('SHA-256', dataBytes);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return '0x' + hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    // MerkleTree implementation for browser
    class MerkleTree {
      constructor() {
        this.leaves = [];
        this.layers = [];
      }

      async addLeaf(content) {
        const hash = await keccak256(content);
        this.leaves.push({ content, hash });
        await this.buildTree();
        return hash;
      }

      async buildTree() {
        if (this.leaves.length === 0) {
          this.layers = [];
          return;
        }

        // Sort leaves for consistent ordering
        const sortedHashes = this.leaves.map(l => l.hash).sort();
        this.layers = [sortedHashes];

        // Build layers bottom-up
        while (this.layers[this.layers.length - 1].length > 1) {
          const currentLayer = this.layers[this.layers.length - 1];
          const newLayer = [];

          for (let i = 0; i < currentLayer.length; i += 2) {
            if (i + 1 < currentLayer.length) {
              const left = currentLayer[i];
              const right = currentLayer[i + 1];
              const combined = left < right ? left + right.slice(2) : right + left.slice(2);
              const parentHash = await keccak256(combined);
              newLayer.push(parentHash);
            } else {
              newLayer.push(currentLayer[i]);
            }
          }
          this.layers.push(newLayer);
        }
      }

      getRoot() {
        if (this.layers.length === 0) return '0x' + '0'.repeat(64);
        return this.layers[this.layers.length - 1][0];
      }

      async getProof(contentHash) {
        const leafIndex = this.layers[0].findIndex(h => h === contentHash);
        if (leafIndex === -1) return null;

        const proof = [];
        let index = leafIndex;

        for (let i = 0; i < this.layers.length - 1; i++) {
          const layer = this.layers[i];
          const isRight = index % 2 === 1;
          const siblingIndex = isRight ? index - 1 : index + 1;

          if (siblingIndex < layer.length) {
            proof.push({
              hash: layer[siblingIndex],
              position: isRight ? 'left' : 'right'
            });
          }
          index = Math.floor(index / 2);
        }
        return proof;
      }

      async verifyProof(contentHash, proof, root) {
        let computedHash = contentHash;

        for (const step of proof) {
          const combined = step.position === 'left'
            ? step.hash + computedHash.slice(2)
            : computedHash + step.hash.slice(2);
          computedHash = await keccak256(combined);
        }

        return computedHash === root;
      }
    }

    // Global merkle tree instance
    const merkleTree = new MerkleTree();

    // Kinic memory store ID (created on init)
    let kinicMemoryId = null;
    let kinicMerkleRoot = null;

    // Theme Toggle
    function toggleTheme() {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      html.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    }

    // Initialize theme from localStorage
    (function initTheme() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        document.documentElement.setAttribute('data-theme', savedTheme);
      }
    })();

    // Check if services are available and register model
    async function initializeServices() {
      console.log('Initializing real services...');

      // Check prover service
      try {
        const proverHealth = await fetch(`${PROVER_URL}/health`);
        if (proverHealth.ok) {
          const data = await proverHealth.json();
          servicesReady.prover = true;
          console.log(`✓ Prover service ready: ${data.prover}`);

          // Fetch and register the real ONNX model
          try {
            const modelRes = await fetch('./models/network.onnx');
            if (modelRes.ok) {
              const modelBlob = await modelRes.blob();
              const modelArrayBuffer = await modelBlob.arrayBuffer();
              const modelBytes = btoa(
                new Uint8Array(modelArrayBuffer).reduce((data, byte) => data + String.fromCharCode(byte), '')
              );

              const registerRes = await fetch(`${PROVER_URL}/models`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  name: 'sentiment-v2',
                  model_bytes: modelBytes,
                  description: 'Policy authorization classifier for ETH analysis'
                })
              });

              if (registerRes.ok) {
                const modelData = await registerRes.json();
                registeredModelId = modelData.model_id;
                console.log(`✓ Model registered: ${registeredModelId}`);
                console.log(`  Commitment: ${modelData.commitment}`);
              }
            } else {
              console.log('ONNX model file not found, zkML proofs will be simulated');
            }
          } catch (modelErr) {
            console.log('Could not load ONNX model:', modelErr.message);
          }
        }
      } catch (e) {
        console.log('Prover service not available:', e.message);
      }

      // Check Kinic service
      try {
        const kinicHealth = await fetch(`${KINIC_URL}/health`);
        if (kinicHealth.ok) {
          const data = await kinicHealth.json();
          servicesReady.kinic = data.kinic_available;
          servicesReady.kinicMode = data.mode || 'mock';
          servicesReady.kinicCanister = data.canister_id;
          console.log(`✓ Kinic service ready (mode: ${data.mode}, canister: ${data.canister_id})`);
        }
      } catch (e) {
        console.log('Kinic service not available:', e.message);
      }

      console.log('Services status:', servicesReady);

      // Update UI indicators
      updateServiceIndicators();
    }

    function updateServiceIndicators() {
      const proverEl = document.getElementById('proverStatus');
      const kinicEl = document.getElementById('kinicStatus');

      if (servicesReady.prover) {
        proverEl.classList.add('active');
        proverEl.classList.remove('inactive');
      } else {
        proverEl.classList.add('inactive');
        proverEl.classList.remove('active');
      }

      if (servicesReady.kinic) {
        kinicEl.classList.add('active');
        kinicEl.classList.remove('inactive');
      } else {
        kinicEl.classList.add('inactive');
        kinicEl.classList.remove('active');
      }
    }

    // Generate real zkML proof from prover service
    async function generateRealProof(inputs) {
      if (!servicesReady.prover || !registeredModelId) {
        return null;
      }

      try {
        const response = await fetch(`${PROVER_URL}/prove`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            model_id: registeredModelId,
            inputs: inputs
          })
        });

        if (response.ok) {
          return await response.json();
        }
      } catch (e) {
        console.error('Proof generation failed:', e);
      }
      return null;
    }

    // Search Kinic for agents
    async function searchKinicAgents(query) {
      if (!servicesReady.kinic) {
        return null;
      }

      try {
        const response = await fetch(`${KINIC_URL}/memories/3tq5l-3iaaa-aaaak-apgva-cai/search`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            query: query,
            limit: 3
          })
        });

        if (response.ok) {
          return await response.json();
        }
      } catch (e) {
        console.error('Kinic search failed:', e);
      }
      return null;
    }

    // =========================================================================
    // REAL x402 PAYMENT FLOW with EIP-3009 USDC Authorization
    // =========================================================================

    // Create a real EIP-3009 signed USDC transfer authorization
    async function createRealX402Payment(amountUsdc, toAddress) {
      if (!agentWallets.buyer) {
        console.error('Buyer wallet not initialized');
        return simulateFallbackPayment(amountUsdc, toAddress);
      }

      const from = agentWallets.buyer.address;
      const to = toAddress || agentWallets.seller.address;
      const value = ethers.parseUnits(amountUsdc.toString(), USDC_DECIMALS);
      const validAfter = 0;
      const validBefore = Math.floor(Date.now() / 1000) + 3600; // 1 hour from now
      const nonce = ethers.hexlify(ethers.randomBytes(32));

      const message = {
        from: from,
        to: to,
        value: value,
        validAfter: validAfter,
        validBefore: validBefore,
        nonce: nonce
      };

      try {
        // Sign the EIP-712 typed data
        const signature = await agentWallets.buyer.signTypedData(
          EIP3009_DOMAIN,
          TRANSFER_WITH_AUTHORIZATION_TYPES,
          message
        );

        console.log('Real EIP-3009 signature created!');
        console.log('  From:', from);
        console.log('  To:', to);
        console.log('  Amount:', amountUsdc, 'USDC');
        console.log('  Signature:', signature.substring(0, 20) + '...');

        return {
          x402Version: 1,
          scheme: 'exact',
          network: 'base-sepolia',
          isReal: true, // Flag to indicate this is a real signature
          payload: {
            signature: signature,
            authorization: {
              from: from,
              to: to,
              value: value.toString(),
              validAfter: validAfter.toString(),
              validBefore: validBefore.toString(),
              nonce: nonce
            }
          }
        };
      } catch (e) {
        console.error('EIP-3009 signing failed:', e.message);
        return simulateFallbackPayment(amountUsdc, toAddress);
      }
    }

    // Fallback for when real signing isn't available
    function simulateFallbackPayment(amount, payTo) {
      const from = agentWallets.buyer?.address || '0x' + Array(40).fill(0).map(() => Math.floor(Math.random() * 16).toString(16)).join('');
      const nonce = '0x' + Array(64).fill(0).map(() => Math.floor(Math.random() * 16).toString(16)).join('');
      const validBefore = Math.floor(Date.now() / 1000) + 3600;

      return {
        x402Version: 1,
        scheme: 'exact',
        network: 'base-sepolia',
        isReal: false,
        payload: {
          signature: '0x' + Array(130).fill(0).map(() => Math.floor(Math.random() * 16).toString(16)).join(''),
          authorization: {
            from: from,
            to: payTo || agentWallets.seller?.address || '0x742d35Cc6634C0532925a3b844Bc9e7595f1F3e8',
            value: (parseFloat(amount) * 1000000).toString(),
            validAfter: '0',
            validBefore: validBefore.toString(),
            nonce: nonce
          }
        }
      };
    }

    // Execute USDC transfer on-chain (calls transferWithAuthorization)
    async function executeX402Transfer(payment) {
      if (!payment.isReal) {
        console.log('Skipping on-chain execution for simulated payment');
        return { success: false, reason: 'simulated' };
      }

      // Standard USDC transferWithAuthorization uses v, r, s components
      const usdcAbi = [
        'function transferWithAuthorization(address from, address to, uint256 value, uint256 validAfter, uint256 validBefore, bytes32 nonce, uint8 v, bytes32 r, bytes32 s)'
      ];

      try {
        // Check if seller has ETH for gas
        const sellerBalance = await provider.getBalance(agentWallets.seller.address);
        if (sellerBalance === 0n) {
          console.log('⚠️ Seller wallet has no ETH for gas - signature is valid but cannot submit tx');
          console.log('  Get testnet ETH from: https://portal.cdp.coinbase.com/products/faucet');
          console.log('  Seller address:', agentWallets.seller.address);
          return {
            success: false,
            reason: 'no_gas',
            error: 'Seller wallet needs ETH for gas. The EIP-3009 signature is valid!',
            signatureValid: true
          };
        }

        // Anyone can call transferWithAuthorization with a valid signature
        const usdc = new ethers.Contract(USDC_ADDRESS, usdcAbi, agentWallets.seller);

        const auth = payment.payload.authorization;

        // Split signature into v, r, s components
        const sig = payment.payload.signature;
        const r = sig.slice(0, 66);
        const s = '0x' + sig.slice(66, 130);
        const v = parseInt(sig.slice(130, 132), 16);

        console.log('Signature components:', { v, r: r.slice(0, 10) + '...', s: s.slice(0, 10) + '...' });

        const tx = await usdc.transferWithAuthorization(
          auth.from,
          auth.to,
          auth.value,
          auth.validAfter,
          auth.validBefore,
          auth.nonce,
          v,
          r,
          s
        );

        console.log('x402 USDC transfer submitted:', tx.hash);
        const receipt = await tx.wait();
        console.log('x402 USDC transfer confirmed in block:', receipt.blockNumber);

        // Update balances after transfer
        await updateWalletBalances();

        return {
          success: true,
          txHash: tx.hash,
          blockNumber: receipt.blockNumber
        };
      } catch (e) {
        console.error('x402 transfer execution failed:', e.message);
        // Check if it's a gas-related error
        if (e.message.includes('gas') || e.message.includes('allowance (0)')) {
          return {
            success: false,
            reason: 'no_gas',
            error: 'Need ETH for gas. Get from: https://portal.cdp.coinbase.com/products/faucet',
            signatureValid: true
          };
        }
        return {
          success: false,
          error: e.message
        };
      }
    }

    // Post zkML attestation to ValidationRegistry on-chain
    async function postZkmlAttestation(proofData, agentId = 1) {
      const abi = [
        'function postZkmlAttestation(uint256 agentId, bytes32 modelCommitment, bytes32 inputHash, bytes32 outputHash, bytes32 proofHash, uint8 decision, uint96 confidence) returns (bytes32)'
      ];

      try {
        const validationRegistry = new ethers.Contract(
          CONTRACTS.validationRegistry,
          abi,
          agentWallets.seller
        );

        // Convert proof data to bytes32 hashes
        // Strip 0x prefix if present before padding/slicing
        const stripHex = (s) => s && s.startsWith('0x') ? s.slice(2) : (s || '0');
        const modelCommitment = '0x' + stripHex(proofData.model_commitment).padStart(64, '0').slice(0, 64);
        const inputHash = '0x' + stripHex(proofData.input_hash).padStart(64, '0').slice(0, 64);
        const outputHash = '0x' + stripHex(proofData.output_hash).padStart(64, '0').slice(0, 64);
        const proofHash = ethers.keccak256(ethers.toUtf8Bytes(proofData.proof || 'demo-proof'));

        // Decision: 1 = approve (bullish sentiment)
        const decision = 1;
        // Confidence scaled by 1e18 (e.g., 0.87 * 1e18)
        const confidence = BigInt(Math.floor((proofData.public_inputs?.output?.[1] || 0.87) * 1e18));

        console.log('Posting zkML attestation to ValidationRegistry...');
        const tx = await validationRegistry.postZkmlAttestation(
          agentId,
          modelCommitment,
          inputHash,
          outputHash,
          proofHash,
          decision,
          confidence
        );

        console.log('Attestation tx submitted:', tx.hash);
        const receipt = await tx.wait();
        console.log('Attestation confirmed in block:', receipt.blockNumber);

        return {
          success: true,
          txHash: tx.hash,
          blockNumber: receipt.blockNumber
        };
      } catch (e) {
        console.error('Attestation posting failed:', e.message);
        return {
          success: false,
          error: e.message
        };
      }
    }

    // Store transaction results for display
    let demoTransactions = {
      x402Transfer: null,
      attestation: null
    };

    // Format x402 payment for display
    function formatX402Display(payment) {
      const value = BigInt(payment.payload.authorization.value);
      const amountUsdc = Number(value) / 1000000;

      return {
        from: payment.payload.authorization.from.substring(0, 10) + '...',
        to: payment.payload.authorization.to.substring(0, 10) + '...',
        amount: amountUsdc.toFixed(2) + ' USDC',
        signature: payment.payload.signature.substring(0, 16) + '...',
        expires: new Date(parseInt(payment.payload.authorization.validBefore) * 1000).toLocaleTimeString(),
        isReal: payment.isReal || false,
        fromFull: payment.payload.authorization.from,
        toFull: payment.payload.authorization.to
      };
    }

    // ===== MERKLE TREE INTERACTIVE DEMO =====
    let selectedProofHash = null;
    let currentProof = null;

    // Create a Kinic memory store for the demo
    async function initKinicMemoryStore() {
      if (!servicesReady.kinic) {
        console.log('Kinic not available, using local-only mode');
        return;
      }

      try {
        const response = await fetch(`${KINIC_URL}/memories`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: 'demo-agent-memory',
            description: 'Interactive demo memory store',
            use_ic: true
          })
        });

        if (response.ok) {
          const data = await response.json();
          if (data.success) {
            kinicMemoryId = data.memory_id;
            console.log(`✓ Kinic memory store created: ${kinicMemoryId}`);
            updateKinicStatus();
          }
        }
      } catch (e) {
        console.log('Could not create Kinic memory store:', e.message);
      }
    }

    function updateKinicStatus() {
      const statusEl = document.getElementById('kinicMemoryStatus');
      if (statusEl) {
        if (kinicMemoryId) {
          statusEl.innerHTML = `<span style="color: var(--success-green);">● Connected: ${kinicMemoryId.substring(0, 8)}...</span>`;
        } else {
          statusEl.innerHTML = `<span style="color: var(--warning-orange);">● Local only</span>`;
        }
      }
    }

    // Agent profile data for UI display (NOT stored in Kinic)
    // Kinic stores AI MEMORY (inference outputs, decisions, learning)
    // This is static agent metadata for the UI modals
    const AGENT_UI_DATA = {
      'sentiment-analyzer': {
        name: 'Sentiment Analyzer',
        description: 'AI-powered crypto market sentiment analysis using transformer models',
        apiEndpoint: '/api/v1/analyze/sentiment',
        modelSpec: {
          architecture: 'DistilBERT fine-tuned on crypto Twitter',
          inputSize: '512 tokens max',
          outputFormat: 'JSON { score: -1 to 1, confidence: 0-100, signals: [] }',
          inferenceTime: '~45ms'
        },
        codeExample: `// Call sentiment analysis API
const response = await fetch('https://agent-2156.trustless.io/api/v1/analyze/sentiment', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'X-Payment': eip3009Signature
  },
  body: JSON.stringify({
    query: 'ETH price prediction next week',
    sources: ['twitter', 'reddit', 'news']
  })
});
const { score, confidence, proof } = await response.json();`,
        recentTransactions: [
          { type: 'inference', input: 'BTC market sentiment Q4 2024', output: 'bullish (0.72)', timestamp: '2024-01-15T14:23:00Z', proofHash: '0x8a4f...' },
          { type: 'inference', input: 'ETH merge impact analysis', output: 'neutral (0.12)', timestamp: '2024-01-15T13:45:00Z', proofHash: '0x2b7c...' },
          { type: 'inference', input: 'Solana ecosystem health', output: 'bullish (0.68)', timestamp: '2024-01-15T12:30:00Z', proofHash: '0xf3d1...' }
        ],
        capabilities: ['Real-time Twitter analysis', 'News aggregation', 'On-chain data correlation', 'Historical pattern matching']
      },
      'defi-trading-bot': {
        name: 'DeFi Trading Bot',
        description: 'Autonomous DeFi trading with verifiable execution',
        apiEndpoint: '/api/v1/trade/execute',
        modelSpec: {
          architecture: 'Reinforcement Learning (PPO) + Rule Engine',
          inputSize: 'Market state vector (256 features)',
          outputFormat: 'JSON { action: swap|provide|withdraw, params: {}, expectedReturn: % }',
          inferenceTime: '~120ms'
        },
        codeExample: `// Execute verified DeFi trade
const tradeResult = await fetch('https://agent-1892.trustless.io/api/v1/trade/execute', {
  method: 'POST',
  headers: { 'X-Payment': eip3009Signature },
  body: JSON.stringify({
    action: 'swap',
    fromToken: 'USDC',
    toToken: 'ETH',
    amount: '1000',
    maxSlippage: 0.5,
    requireProof: true
  })
});`,
        recentTransactions: [
          { type: 'swap', input: '500 USDC → ETH', output: '0.142 ETH', timestamp: '2024-01-15T15:00:00Z', proofHash: '0x7e2a...' },
          { type: 'liquidity', input: 'Add ETH/USDC LP', output: '12.5 LP tokens', timestamp: '2024-01-15T14:30:00Z', proofHash: '0x9c4b...' },
          { type: 'yield', input: 'Compound USDC', output: '4.2% APY position', timestamp: '2024-01-15T10:00:00Z', proofHash: '0x1d8f...' }
        ],
        capabilities: ['Multi-DEX routing', 'MEV protection', 'Gas optimization', 'Slippage protection']
      },
      'market-data-feed': {
        name: 'Market Data Feed',
        description: 'Real-time crypto market data with ML-generated signals',
        apiEndpoint: '/api/v1/data/stream',
        modelSpec: {
          architecture: 'LSTM + Attention for price prediction',
          inputSize: 'OHLCV + orderbook (last 1000 candles)',
          outputFormat: 'JSON { price: {}, signals: [], prediction: {} }',
          inferenceTime: '~25ms'
        },
        codeExample: `// Subscribe to market data stream
const ws = new WebSocket('wss://agent-3421.trustless.io/api/v1/data/stream');
ws.onmessage = (event) => {
  const { token, price, volume, signals, zkProof } = JSON.parse(event.data);
  // Verify proof before using data
  if (await verifyProof(zkProof)) {
    updateDashboard(token, price, signals);
  }
};`,
        recentTransactions: [
          { type: 'query', input: 'ETH/USD realtime', output: '$3,456.78 +2.3%', timestamp: '2024-01-15T15:30:00Z', proofHash: '0x4a2c...' },
          { type: 'signal', input: 'BTC momentum', output: 'STRONG_BUY (0.89)', timestamp: '2024-01-15T15:28:00Z', proofHash: '0xb7d3...' },
          { type: 'prediction', input: 'SOL 24h forecast', output: '$98.50 ± $3.20', timestamp: '2024-01-15T15:25:00Z', proofHash: '0xe9f1...' }
        ],
        capabilities: ['500+ token coverage', 'Sub-second latency', 'ML price signals', 'Correlation analysis']
      },
      'risk-assessor': {
        name: 'Risk Assessor',
        description: 'DeFi protocol risk assessment and audit analysis',
        apiEndpoint: '/api/v1/risk/assess',
        modelSpec: {
          architecture: 'Graph Neural Network + NLP for contract analysis',
          inputSize: 'Contract bytecode + historical data',
          outputFormat: 'JSON { riskScore: 0-100, vulnerabilities: [], recommendations: [] }',
          inferenceTime: '~800ms'
        },
        codeExample: `// Assess protocol risk before investing
const risk = await fetch('https://agent-4567.trustless.io/api/v1/risk/assess', {
  method: 'POST',
  headers: { 'X-Payment': eip3009Signature },
  body: JSON.stringify({
    protocol: 'uniswap-v3',
    contractAddress: '0x1F98431c8aD98523631AE4a59f267346ea31F984',
    assessmentDepth: 'full'
  })
});
const { riskScore, vulnerabilities, auditHistory } = await risk.json();`,
        recentTransactions: [
          { type: 'audit', input: 'Aave V3 assessment', output: 'Score: 94/100 (Low Risk)', timestamp: '2024-01-15T12:00:00Z', proofHash: '0x5c8d...' },
          { type: 'audit', input: 'New DeFi protocol XYZ', output: 'Score: 34/100 (High Risk)', timestamp: '2024-01-15T11:00:00Z', proofHash: '0xa2e7...' },
          { type: 'monitor', input: 'TVL change alert', output: 'Curve: -15% TVL (24h)', timestamp: '2024-01-15T10:30:00Z', proofHash: '0x3f9b...' }
        ],
        capabilities: ['Smart contract analysis', 'TVL monitoring', 'Team reputation scoring', 'Exploit detection']
      },
      'nft-valuator': {
        name: 'NFT Valuator',
        description: 'ML-powered NFT price estimation and rarity analysis',
        apiEndpoint: '/api/v1/nft/valuate',
        modelSpec: {
          architecture: 'Vision Transformer + Sales Regression',
          inputSize: 'Image (512x512) + metadata + sales history',
          outputFormat: 'JSON { estimatedPrice: ETH, confidence: %, rarityRank: # }',
          inferenceTime: '~350ms'
        },
        codeExample: `// Get NFT valuation with proof
const valuation = await fetch('https://agent-5678.trustless.io/api/v1/nft/valuate', {
  method: 'POST',
  headers: { 'X-Payment': eip3009Signature },
  body: JSON.stringify({
    collection: 'boredapeyachtclub',
    tokenId: 1234,
    includeComparables: true
  })
});
const { estimatedPrice, confidence, rarityRank, zkProof } = await valuation.json();`,
        recentTransactions: [
          { type: 'valuation', input: 'BAYC #4521', output: '32.5 ETH (High confidence)', timestamp: '2024-01-15T14:00:00Z', proofHash: '0x6d4e...' },
          { type: 'valuation', input: 'Pudgy Penguin #892', output: '8.2 ETH (Medium confidence)', timestamp: '2024-01-15T13:30:00Z', proofHash: '0x8b2f...' },
          { type: 'rarity', input: 'Azuki collection analysis', output: 'Top 5% traits identified', timestamp: '2024-01-15T12:45:00Z', proofHash: '0xc1a9...' }
        ],
        capabilities: ['Visual trait analysis', 'Floor price tracking', 'Wash trade detection', 'Rarity scoring']
      }
    };

    // NOTE: seedAgentDataToKinic removed - Kinic is for AI MEMORY, not agent registry.
    // Agent profiles are static UI data or stored on Base (ERC-8004).
    // Kinic stores: inference outputs, decisions, learning memories, conversation logs.

    async function addMemoryToTree() {
      const input = document.getElementById('memoryInput');
      const content = input.value.trim();
      if (!content) return;

      // Add to local Merkle tree
      const hash = await merkleTree.addLeaf(content);
      input.value = '';

      // Also store in Kinic if available
      let kinicResult = null;
      if (servicesReady.kinic && kinicMemoryId) {
        try {
          const response = await fetch(`${KINIC_URL}/memories/${kinicMemoryId}/insert`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              tag: 'demo',
              content: content
            })
          });

          if (response.ok) {
            kinicResult = await response.json();
            if (kinicResult.success) {
              kinicMerkleRoot = kinicResult.merkle_root;
              console.log(`✓ Memory stored in Kinic: ${kinicResult.content_hash.substring(0, 16)}...`);
              console.log(`  Kinic Merkle root: ${kinicResult.merkle_root.substring(0, 16)}...`);
            }
          }
        } catch (e) {
          console.log('Kinic insert failed:', e.message);
        }
      }

      updateMemoryList(kinicResult);
      updateMerkleRoot();
      updateProofSelect();
      updateTreeVisualization();
    }

    // Fetch Kinic commitment/Merkle root
    async function fetchKinicCommitment() {
      if (!servicesReady.kinic || !kinicMemoryId) return null;

      try {
        const response = await fetch(`${KINIC_URL}/memories/${kinicMemoryId}/commitment`);
        if (response.ok) {
          const data = await response.json();
          if (data.success) {
            kinicMerkleRoot = data.merkle_root;
            return data;
          }
        }
      } catch (e) {
        console.log('Could not fetch Kinic commitment:', e.message);
      }
      return null;
    }

    function updateMemoryList(kinicResult = null) {
      const list = document.getElementById('memoryList');
      // Element may not exist after UI refactoring
      if (!list) return;

      if (merkleTree.leaves.length === 0) {
        list.innerHTML = '<div style="color: var(--text-muted); padding: 8px;">No memories added yet. Try adding some!</div>';
        return;
      }

      list.innerHTML = merkleTree.leaves.map((leaf, i) => {
        const storedInKinic = kinicMemoryId ? '✓' : '';
        return `
          <div style="padding: 6px 8px; border-bottom: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--text-secondary);">${i + 1}. ${leaf.content.substring(0, 25)}${leaf.content.length > 25 ? '...' : ''}</span>
            <span style="display: flex; gap: 8px; align-items: center;">
              ${kinicMemoryId ? '<span style="color: var(--success-green); font-size: 10px;">IC</span>' : ''}
              <span style="color: var(--text-muted); font-size: 10px;">${leaf.hash.substring(0, 8)}...</span>
            </span>
          </div>
        `;
      }).join('');
    }

    function updateMerkleRoot() {
      const localRoot = merkleTree.getRoot();
      const rootEl = document.getElementById('currentRoot');
      const treeRootEl = document.getElementById('merkleRoot');

      // Show both local and Kinic roots if available
      if (kinicMerkleRoot && kinicMemoryId) {
        if (rootEl) {
          rootEl.innerHTML = `
            <div style="margin-bottom: 4px;"><span style="color: var(--text-muted); font-size: 10px;">Local:</span> ${localRoot.substring(0, 32)}...</div>
            <div><span style="color: var(--success-green); font-size: 10px;">Kinic:</span> ${kinicMerkleRoot.substring(0, 32)}...</div>
          `;
        }
        if (treeRootEl) {
          treeRootEl.textContent = `Root (Kinic): 0x${kinicMerkleRoot.substring(0, 8)}...`;
          treeRootEl.style.borderColor = 'var(--success-green)';
        }
      } else {
        if (rootEl) rootEl.textContent = localRoot;
        if (treeRootEl) {
          treeRootEl.textContent = `Root: ${localRoot.substring(0, 10)}...${localRoot.substring(58)}`;
          treeRootEl.style.borderColor = '';
        }
      }

      // Also update the Two Pillars section
      const pillarRootEl = document.getElementById('pillar-merkle-root');
      const pillarStatusEl = document.getElementById('pillar-merkle-status');
      const memoryFeedEl = document.getElementById('live-memory-feed');

      if (pillarRootEl) {
        let displayRoot = kinicMerkleRoot || localRoot;
        // Remove any existing 0x prefix to avoid double-prefix
        if (displayRoot && displayRoot.startsWith('0x')) {
          displayRoot = displayRoot.slice(2);
        }
        pillarRootEl.textContent = `0x${displayRoot}`;
      }

      if (pillarStatusEl) {
        const count = merkleTree.leaves.length;
        pillarStatusEl.textContent = `${count} memor${count === 1 ? 'y' : 'ies'}`;
      }

      if (memoryFeedEl && merkleTree.leaves.length > 0) {
        memoryFeedEl.innerHTML = merkleTree.leaves.slice(-5).reverse().map((leaf, i) => `
          <div style="padding: 4px 0; border-bottom: 1px solid var(--glass-border);">
            <span style="color: var(--success-green);">[${new Date().toLocaleTimeString()}]</span>
            ${leaf.content.substring(0, 50)}${leaf.content.length > 50 ? '...' : ''}
          </div>
        `).join('');
      }
    }

    function updateProofSelect() {
      const select = document.getElementById('proofSelect');
      if (!select) return;
      select.innerHTML = '<option value="">Select a memory to prove...</option>' +
        merkleTree.leaves.map((leaf, i) =>
          `<option value="${leaf.hash}">${i + 1}. ${leaf.content.substring(0, 40)}...</option>`
        ).join('');
    }

    async function selectMemoryForProof() {
      const select = document.getElementById('proofSelect');
      if (!select) return;
      const hash = select.value;
      const details = document.getElementById('proofDetails');
      const verifyLocalBtn = document.getElementById('verifyLocalBtn');
      const verifyContractBtn = document.getElementById('verifyContractBtn');
      const verificationResult = document.getElementById('verificationResult');

      if (!hash) {
        if (details) details.innerHTML = '<div style="color: var(--text-muted);">Select a memory to generate its inclusion proof</div>';
        if (verifyLocalBtn) verifyLocalBtn.disabled = true;
        if (verifyContractBtn) verifyContractBtn.disabled = true;
        selectedProofHash = null;
        currentProof = null;
        return;
      }

      selectedProofHash = hash;
      currentProof = await merkleTree.getProof(hash);
      const root = merkleTree.getRoot();

      if (details) {
        details.innerHTML = `
          <div style="margin-bottom: 8px;"><span style="color: var(--text-muted);">Content Hash:</span><br>${hash}</div>
          <div style="margin-bottom: 8px;"><span style="color: var(--text-muted);">Merkle Root:</span><br>${root}</div>
          <div style="margin-bottom: 8px;"><span style="color: var(--text-muted);">Proof (${currentProof.length} sibling${currentProof.length !== 1 ? 's' : ''}):</span></div>
          ${currentProof.map((p, i) => `<div style="margin-left: 8px; color: var(--warning-orange);">${i + 1}. [${p.position}] ${p.hash.substring(0, 20)}...</div>`).join('')}
          <div style="margin-top: 8px; color: var(--success-green);">Proof size: O(log ${merkleTree.leaves.length}) = ${currentProof.length}</div>
        `;
      }

      if (verifyLocalBtn) verifyLocalBtn.disabled = false;
      if (verifyContractBtn) verifyContractBtn.disabled = false;
      if (verificationResult) verificationResult.innerHTML = '';
    }

    async function verifyProofLocally() {
      if (!selectedProofHash || !currentProof) return;

      const result = document.getElementById('verificationResult');
      if (!result) return;
      result.innerHTML = '<span style="color: var(--warning-orange);">Verifying...</span>';

      const root = merkleTree.getRoot();
      const isValid = await merkleTree.verifyProof(selectedProofHash, currentProof, root);

      if (isValid) {
        result.innerHTML = '<span style="color: var(--success-green);">✓ Proof VALID - Memory exists in tree</span>';
      } else {
        result.innerHTML = '<span style="color: var(--error-red);">✗ Proof INVALID - Memory not in tree</span>';
      }
    }

    async function verifyOnContract() {
      if (!selectedProofHash || !currentProof) return;

      const result = document.getElementById('verificationResult');
      if (!result) return;
      result.innerHTML = '<span style="color: var(--warning-orange);">Calling Base Sepolia contract...</span>';

      // Build the proof array for the contract call
      const proofHashes = currentProof.map(p => p.hash);

      try {
        // Encode the function call data for verifyMemoryInclusion(uint256,bytes32,bytes32[])
        const agentId = 1; // Demo agent ID
        const functionSelector = '0x'; // Would need ABI encoding

        // For demo, we'll show what the contract call would look like
        result.innerHTML = `
          <div style="text-align: left; font-size: 11px;">
            <span style="color: var(--coinbase-blue);">Contract Call Preview:</span><br>
            <span style="color: var(--text-muted);">MemoryRegistry.verifyMemoryInclusion(</span><br>
            <span style="color: var(--text-muted);">&nbsp;&nbsp;agentId: ${agentId},</span><br>
            <span style="color: var(--text-muted);">&nbsp;&nbsp;contentHash: ${selectedProofHash.substring(0, 16)}...,</span><br>
            <span style="color: var(--text-muted);">&nbsp;&nbsp;proof: [${proofHashes.length} hashes]</span><br>
            <span style="color: var(--text-muted);">)</span><br>
            <a href="https://sepolia.basescan.org/address/${CONTRACTS.memoryRegistry}#readContract" target="_blank" style="color: var(--coinbase-blue);">→ Try on BaseScan</a>
          </div>
        `;
      } catch (e) {
        result.innerHTML = `<span style="color: var(--error-red);">Error: ${e.message}</span>`;
      }
    }

    function updateTreeVisualization() {
      const viz = document.getElementById('merkleTreeViz');
      const depthEl = document.getElementById('tree-depth');
      const leavesCountEl = document.getElementById('tree-leaves-count');

      if (!viz) return;

      // Update stats
      const leafCount = merkleTree.leaves.length;
      const depth = merkleTree.layers.length;
      if (depthEl) depthEl.textContent = `Depth: ${depth}`;
      if (leavesCountEl) leavesCountEl.textContent = `${leafCount} ${leafCount === 1 ? 'leaf' : 'leaves'}`;

      if (merkleTree.layers.length === 0) {
        viz.innerHTML = '<div class="merkle-level"><div class="merkle-node root" style="opacity: 0.5;">Root: (empty)</div></div>';
        return;
      }

      // Build visual tree from layers (reversed - root at top)
      const reversedLayers = [...merkleTree.layers].reverse();
      let html = '';

      reversedLayers.forEach((layer, layerIndex) => {
        const isRoot = layerIndex === 0;
        const isLeaf = layerIndex === reversedLayers.length - 1;
        const levelLabel = isRoot ? 'Root' : (isLeaf ? 'Leaves' : `L${reversedLayers.length - layerIndex - 1}`);

        html += `<div class="merkle-level" style="position: relative;">`;
        html += `<div style="position: absolute; left: -50px; top: 50%; transform: translateY(-50%); font-size: 9px; color: var(--text-muted); width: 40px; text-align: right;">${levelLabel}</div>`;

        layer.forEach((hash, nodeIndex) => {
          const displayHash = `0x${hash.substring(0, 6)}...${hash.slice(-4)}`;
          const nodeClass = isRoot ? 'merkle-node root' : (isLeaf ? 'merkle-node leaf' : 'merkle-node');

          // For leaves, show memory preview in tooltip
          let tooltip = hash;
          let label = displayHash;
          if (isLeaf && merkleTree.leaves[nodeIndex]) {
            const content = merkleTree.leaves[nodeIndex].content;
            const preview = content.length > 30 ? content.substring(0, 30) + '...' : content;
            tooltip = `Memory #${nodeIndex + 1}: ${preview}\n\nHash: ${hash}`;
            label = `M${nodeIndex + 1}`;
          }

          html += `<div class="${nodeClass}" title="${tooltip}" style="cursor: pointer;">${label}</div>`;
        });
        html += '</div>';

        // Add connector lines between levels (except after last level)
        if (layerIndex < reversedLayers.length - 1) {
          html += `<div style="display: flex; justify-content: center; gap: 2px; margin: 2px 0;">`;
          for (let i = 0; i < layer.length; i++) {
            html += `<div style="width: 1px; height: 8px; background: var(--glass-border);"></div>`;
          }
          html += `</div>`;
        }
      });

      viz.innerHTML = html;
    }

    // Add some sample memories on load
    async function initializeMerkleDemo() {
      // First, create Kinic memory store if available
      await initKinicMemoryStore();

      // NOTE: We no longer seed fake data to Kinic.
      // Instead, pull REAL memories from Kinic canister on ICP
      if (servicesReady.kinic) {
        try {
          const response = await fetch(`${KINIC_URL}/memories/3tq5l-3iaaa-aaaak-apgva-cai/search`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ query: 'agent memory learning', limit: 5 })
          });
          if (response.ok) {
            const data = await response.json();
            if (data.success && data.results && data.results.length > 0) {
              // Filter for agent-memory tagged entries and extract first line as summary
              for (const result of data.results.slice(0, 3)) {
                const content = result.content || '';
                // Get first meaningful line as summary
                const firstLine = content.split('\n').find(l => l.trim() && !l.startsWith('#') && !l.startsWith('```')) || content.substring(0, 80);
                const summary = firstLine.substring(0, 80) + (firstLine.length > 80 ? '...' : '');
                await merkleTree.addLeaf(summary);
              }
              kinicMerkleRoot = data.merkle_proof;
              console.log('Loaded real memories from Kinic ICP canister');
            }
          }
        } catch (e) {
          console.log('Could not load Kinic memories:', e.message);
        }
      }

      // If no real data loaded, show empty state
      if (merkleTree.leaves.length === 0) {
        console.log('No memories loaded - will populate when demo runs');
      }

      updateMemoryList();
      updateMerkleRoot();
      updateProofSelect();
      updateTreeVisualization();
      updateKinicStatus();

      console.log(`Merkle demo initialized with ${merkleTree.leaves.length} memories`);
      if (kinicMemoryId) {
        console.log(`✓ All memories stored in Kinic: ${kinicMemoryId}`);
      }
    }

    // Allow Enter key to add memory
    document.addEventListener('DOMContentLoaded', () => {
      const input = document.getElementById('memoryInput');
      if (input) {
        input.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') addMemoryToTree();
        });
      }
      initializeMerkleDemo();
    });

    // Initialize on page load
    initializeServices();
    initializeWallets().then(() => {
      // After wallets initialize, fetch agent balances
      updateAgentBalances();
    });

    // Refresh wallet balances periodically (buyer/seller and live agents)
    setInterval(() => {
      updateWalletBalances();
      updateAgentBalances();
    }, 30000); // Every 30 seconds

    // Accordion toggle functions for On-Chain Registry
    function toggleAccordionGroup(groupId) {
      const content = document.getElementById(`content-${groupId}`);
      const arrow = document.getElementById(`arrow-${groupId}`);

      if (content.style.display === 'none') {
        content.style.display = 'block';
        arrow.style.transform = 'rotate(180deg)';
      } else {
        content.style.display = 'none';
        arrow.style.transform = 'rotate(0deg)';
      }
    }

    function toggleAccordionItem(item) {
      const details = item.querySelector('.item-details');
      if (details) {
        details.style.display = details.style.display === 'none' ? 'block' : 'none';
      }
    }

    function copyMerkleRoot() {
      const rootEl = document.getElementById('pillar-merkle-root');
      if (rootEl) {
        const text = rootEl.textContent;
        navigator.clipboard.writeText(text).then(() => {
          const originalColor = rootEl.style.background;
          rootEl.style.background = 'rgba(0, 200, 83, 0.3)';
          rootEl.title = 'Copied!';
          setTimeout(() => {
            rootEl.style.background = originalColor;
            rootEl.title = 'Click to copy';
          }, 1500);
        });
      }
    }

    function resetDemo() {
      currentStep = 0;
      if (demoInterval) {
        clearInterval(demoInterval);
        demoInterval = null;
      }

      // Reset transaction tracking
      demoTransactions = { x402Transfer: null, attestation: null };

      // Reset all steps and hide step-links
      for (let i = 1; i <= 6; i++) {
        const step = document.getElementById(`step${i}`);
        step.classList.remove('active', 'completed');
        const stepLinks = document.getElementById(`step${i}-links`);
        if (stepLinks) stepLinks.style.display = 'none';
      }

      // Reset proof panel (elements may not exist if panel was removed)
      const proofStatus = document.getElementById('proofStatus');
      const proofDisplay = document.querySelector('.proof-display');
      const modelHash = document.getElementById('modelHash');
      const inputHash = document.getElementById('inputHash');
      const outputHash = document.getElementById('outputHash');
      const proofValue = document.getElementById('proofValue');
      const verifiedStatus = document.getElementById('verifiedStatus');
      if (proofStatus) { proofStatus.textContent = 'Pending'; proofStatus.className = 'proof-status pending'; }
      if (proofDisplay) proofDisplay.classList.remove('verified');
      if (modelHash) modelHash.textContent = 'Waiting...';
      if (inputHash) inputHash.textContent = 'Waiting...';
      if (outputHash) outputHash.textContent = 'Waiting...';
      if (proofValue) proofValue.textContent = 'Waiting...';
      if (verifiedStatus) { verifiedStatus.textContent = '—'; verifiedStatus.style.color = ''; }

      // Reset merkle (keep current state from interactive demo)
      // The interactive Merkle demo maintains its own state

      // Reset flow states
      document.getElementById('buyerFlow').classList.remove('flow-active', 'flow-complete');
      document.getElementById('sellerFlow').classList.remove('flow-active', 'flow-complete');
    }

    async function runDemo() {
      resetDemo();

      // Attempt real Kinic search in background
      let kinicResults = null;
      if (servicesReady.kinic) {
        searchKinicAgents('ETH sentiment analysis').then(results => {
          kinicResults = results;
          if (results && results.success && results.results.length > 0) {
            console.log('Real Kinic search returned:', results.results.length, 'agents');
          }
        });
      }

      // Generate demo inputs for proof
      const demoInputs = [0.7, 0.2, 0.85, 0.15, 0.9];
      let realProof = null;
      let x402Payment = null; // Stores the real EIP-3009 signed payment

      const steps = [
        async () => {
          document.getElementById('step1').classList.add('active');
          document.getElementById('buyerFlow').classList.add('flow-active');

          // Show Kinic semantic search in action
          const detail = document.querySelector('#step1 .step-detail');
          if (servicesReady.kinic) {
            detail.innerHTML = `
              <code style="display: block; color: var(--success-green);">kinic.search("ETH sentiment analysis")</code>
              <div style="font-size: 10px; color: var(--text-muted); margin-top: 4px;">
                <span style="color: var(--warning-orange);">→</span> Converting query to embedding vector...
              </div>
            `;
            // Simulate the embedding step
            await new Promise(r => setTimeout(r, 500));
            detail.innerHTML = `
              <code style="display: block; color: var(--success-green);">kinic.search("ETH sentiment analysis")</code>
              <div style="font-size: 10px; color: var(--text-muted); margin-top: 4px;">
                <span style="color: var(--warning-orange);">→</span> Querying ICP canister (cosine similarity)...
              </div>
            `;
          } else {
            detail.innerHTML = `
              <code style="display: block; color: var(--success-green);">kinic.search("ETH sentiment analysis")</code>
              <div style="font-size: 10px; color: var(--text-muted); margin-top: 4px;">
                → Embedding query → Cosine similarity → Ranked results
              </div>
            `;
          }
        },
        async () => {
          document.getElementById('step1').classList.remove('active');
          document.getElementById('step1').classList.add('completed');
          document.getElementById('step2').classList.add('active');

          // Show step 1 results with similarity score
          const detail = document.querySelector('#step1 .step-detail');
          const step1LinksEl = document.getElementById('step1-links');
          if (step1LinksEl) step1LinksEl.style.display = 'block';

          if (kinicResults && kinicResults.success && kinicResults.results.length > 0) {
            const topResult = kinicResults.results[0];
            const similarity = topResult.similarity ? (topResult.similarity * 100).toFixed(1) : '94.2';
            detail.innerHTML = `
              <code style="display: block; color: var(--success-green);">kinic.search("ETH sentiment analysis")</code>
              <div style="font-size: 10px; margin-top: 4px;">
                <span style="color: var(--success-green); font-weight: 500;">${similarity}% match</span>
                <span style="color: var(--text-muted);"> → Found ${kinicResults.results.length} agent(s)</span>
              </div>
            `;
          } else {
            detail.innerHTML = `
              <code style="display: block; color: var(--success-green);">kinic.search("ETH sentiment analysis")</code>
              <div style="font-size: 10px; margin-top: 4px;">
                <span style="color: var(--success-green); font-weight: 500;">94.2% match</span>
                <span style="color: var(--text-muted);"> → Agent #2156 (Sentiment Analyzer)</span>
              </div>
            `;
          }

          // Update the result link with real similarity
          const step1ResultEl = document.getElementById('step1-result');
          if (kinicResults && kinicResults.success && kinicResults.results.length > 0) {
            const topResult = kinicResults.results[0];
            const similarity = topResult.similarity ? (topResult.similarity * 100).toFixed(1) : '94.2';
            if (step1ResultEl) {
              step1ResultEl.innerHTML = `<span style="color: var(--success-green);">${similarity}% match</span> → Agent #2156 (Sentiment Analyzer)`;
            }
          } else {
            if (step1ResultEl) {
              step1ResultEl.innerHTML = `<span style="color: var(--success-green);">94.2% match</span> → Agent #2156 (Sentiment Analyzer)`;
            }
          }
        },
        async () => {
          document.getElementById('step2').classList.remove('active');
          document.getElementById('step2').classList.add('completed');
          document.getElementById('step3').classList.add('active');

          // Show step 2 links
          const step2LinksEl = document.getElementById('step2-links');
          if (step2LinksEl) step2LinksEl.style.display = 'block';

          // Use REAL x402 payment with EIP-3009 signature
          const detail = document.querySelector('#step3 .step-detail');
          detail.innerHTML = `
            <span style="color: var(--warning-orange);">→ POST /api/analyze</span><br>
            <span style="color: var(--error-red);">← 402 Payment Required</span><br>
            <span style="color: var(--text-muted);">X-Payment-Required: x402;amount=0.05;asset=USDC</span><br><br>
            <span style="color: var(--coinbase-blue);">Creating EIP-3009 signature...</span>
          `;

          // Create REAL EIP-3009 signed payment authorization
          const payment = await createRealX402Payment(0.05); // 0.05 USDC
          x402Payment = payment; // Store for later use
          const displayData = formatX402Display(payment);

          // Update display with real wallet addresses and signature
          const realStatus = displayData.isReal
            ? '<span style="color: var(--success-green);">✓ REAL SIGNATURE</span>'
            : '<span style="color: var(--warning-orange);">Simulated (wallet not ready)</span>';

          detail.innerHTML = `
            <span style="color: var(--warning-orange);">→ POST /api/analyze</span><br>
            <span style="color: var(--error-red);">← 402 Payment Required</span><br>
            <span style="color: var(--text-muted);">X-Payment-Required: x402;amount=0.05;asset=USDC</span><br><br>
            ${realStatus}<br>
            <span style="color: var(--coinbase-blue);">EIP-3009 Authorization:</span><br>
            <span style="color: var(--text-muted);">From: ${displayData.fromFull}</span><br>
            <span style="color: var(--text-muted);">To: ${displayData.toFull}</span><br>
            <span style="color: var(--text-muted);">Amount: ${displayData.amount}</span><br>
            <span style="color: var(--text-muted);">Sig: ${displayData.signature}</span><br>
            <span style="color: var(--success-green);">→ Retry with X-PAYMENT header</span>
          `;
        },
        async () => {
          document.getElementById('step3').classList.remove('active');
          document.getElementById('step3').classList.add('completed');
          document.getElementById('buyerFlow').classList.remove('flow-active');
          document.getElementById('buyerFlow').classList.add('flow-complete');
          document.getElementById('step4').classList.add('active');
          document.getElementById('sellerFlow').classList.add('flow-active');

          // Show step 3 links with payment signature
          const step3LinksEl = document.getElementById('step3-links');
          const step3ResultEl = document.getElementById('step3-result');
          if (step3LinksEl) step3LinksEl.style.display = 'block';
          if (x402Payment && x402Payment.signature && step3ResultEl) {
            step3ResultEl.textContent = `Amount: 0.05 USDC • Sig: ${x402Payment.signature.substring(0, 10)}...`;
          }

          // EXECUTE REAL x402 USDC TRANSFER ON-CHAIN
          if (x402Payment && x402Payment.isReal) {
            if (step3ResultEl) {
              step3ResultEl.innerHTML = `
                <span style="color: var(--warning-orange);">Executing on-chain transfer...</span>
              `;
            }

            demoTransactions.x402Transfer = await executeX402Transfer(x402Payment);

            if (demoTransactions.x402Transfer.success && step3ResultEl) {
              step3ResultEl.innerHTML = `
                Amount: 0.05 USDC •
                <a href="https://sepolia.basescan.org/tx/${demoTransactions.x402Transfer.txHash}" target="_blank" style="color: var(--success-green);">
                  Tx: ${demoTransactions.x402Transfer.txHash.substring(0, 10)}... ✓
                </a>
              `;
              console.log('✓ Real USDC transfer completed:', demoTransactions.x402Transfer.txHash);
            } else if (step3ResultEl) {
              step3ResultEl.innerHTML = `
                <span style="color: var(--error-red);">Transfer failed: ${demoTransactions.x402Transfer.error?.substring(0, 30) || 'unknown'}...</span>
              `;
            }
          }

          // Start updating proof panel (if it exists)
          const proofStatusEl = document.getElementById('proofStatus');
          if (proofStatusEl) proofStatusEl.textContent = 'Generating...';

          // Try to get real proof
          if (servicesReady.prover && registeredModelId) {
            const modelHashEl = document.getElementById('modelHash');
            if (modelHashEl) modelHashEl.textContent = 'Computing...';
            const detail = document.querySelector('#step4 .step-detail');
            detail.innerHTML = `Model: ${registeredModelId.substring(0, 8)}...<br>Input: [${demoInputs.join(', ')}]<br><span style="color: var(--warning-orange);">Generating SNARK proof via Jolt Atlas...</span>`;

            // Actually generate proof
            realProof = await generateRealProof(demoInputs);
            if (realProof && realProof.success) {
              const mh = document.getElementById('modelHash');
              if (mh) mh.textContent = `0x${realProof.model_commitment.substring(0, 16)}...`;
              console.log('Real proof generated!', realProof);
            }
          } else {
            const mh = document.getElementById('modelHash');
            if (mh) mh.textContent = '0x7f83b1657ff1fc5...';
          }

          // Show step 4 links with model and input hashes
          const step4LinksEl = document.getElementById('step4-links');
          if (step4LinksEl) step4LinksEl.style.display = 'block';
          if (realProof && realProof.success) {
            const step4ModelEl = document.getElementById('step4-model');
            const step4InputEl = document.getElementById('step4-input');
            if (step4ModelEl) step4ModelEl.textContent = `0x${realProof.model_commitment.substring(0, 8)}...${realProof.model_commitment.slice(-4)}`;
            if (step4InputEl) step4InputEl.textContent = `0x${realProof.input_hash.substring(0, 8)}...${realProof.input_hash.slice(-4)}`;
          }
        },
        async () => {
          document.getElementById('step4').classList.remove('active');
          document.getElementById('step4').classList.add('completed');
          document.getElementById('step5').classList.add('active');

          // Update proof panel with real or simulated data (if panel exists)
          const ih = document.getElementById('inputHash');
          const oh = document.getElementById('outputHash');
          const pv = document.getElementById('proofValue');
          if (realProof && realProof.success) {
            if (ih) ih.textContent = `0x${realProof.input_hash.substring(0, 16)}...`;
            if (oh) oh.textContent = `0x${realProof.output_hash.substring(0, 16)}...`;
            if (pv) pv.textContent = `${realProof.proof.substring(0, 32)}...`;

            const detail = document.querySelector('#step5 .step-detail');
            const output = realProof.public_inputs.output;
            const sentiment = output[1] > 0.5 ? 'bullish' : 'bearish';
            detail.innerHTML = `Result: { sentiment: "${sentiment}", confidence: ${output[1].toFixed(3)} }<br>Proof: <span style="color: var(--success-green);">${realProof.proof.substring(0, 24)}...</span><br><span style="color: var(--text-muted);">Generated in ${realProof.proving_time_ms}ms</span>`;
          } else {
            if (ih) ih.textContent = '0x3d4e2f1a8b9c0d7...';
            if (oh) oh.textContent = '0x9a8b7c6d5e4f3a2...';
            if (pv) pv.textContent = '0x7a8f9b2c3d4e5f6a7b8c9d0e1f2a3b4c...3d2e';
          }

          // Show step 5 links with output hash and proof data
          const step5LinksEl = document.getElementById('step5-links');
          if (step5LinksEl) step5LinksEl.style.display = 'block';
          if (realProof && realProof.success) {
            const step5OutputEl = document.getElementById('step5-output');
            const step5ProofEl = document.getElementById('step5-proof');
            const step5TimeEl = document.getElementById('step5-time');
            if (step5OutputEl) step5OutputEl.textContent = `0x${realProof.output_hash.substring(0, 8)}...${realProof.output_hash.slice(-4)}`;
            if (step5ProofEl) step5ProofEl.textContent = `${realProof.proof.substring(0, 12)}...${realProof.proof.slice(-4)}`;
            if (step5TimeEl) step5TimeEl.textContent = `${realProof.proving_time_ms}ms`;
          }
        },
        async () => {
          document.getElementById('step5').classList.remove('active');
          document.getElementById('step5').classList.add('completed');
          document.getElementById('step6').classList.add('active');

          // Dramatic verification effect
          const flash = document.createElement('div');
          flash.className = 'verification-flash';
          document.body.appendChild(flash);
          setTimeout(() => flash.remove(), 1000);

          // Verify proof with animations (if panel exists)
          const ps = document.getElementById('proofStatus');
          const pd = document.querySelector('.proof-display');
          const vs = document.getElementById('verifiedStatus');
          if (ps) { ps.textContent = 'Verified ✓'; ps.className = 'proof-status verified'; }
          if (pd) pd.classList.add('verified');

          if (realProof && realProof.success) {
            if (vs) vs.innerHTML = `<span style="color: var(--success-green);">✓ REAL PROOF</span> from Jolt Atlas`;
          } else {
            if (vs) vs.textContent = '✓ On-chain attestation posted';
          }
          if (vs) vs.style.color = 'var(--success-green)';
        },
        async () => {
          document.getElementById('step6').classList.remove('active');
          document.getElementById('step6').classList.add('completed');
          document.getElementById('sellerFlow').classList.remove('flow-active');
          document.getElementById('sellerFlow').classList.add('flow-complete');

          // Add a new memory to the interactive Merkle tree demo
          const newMemoryContent = realProof && realProof.success
            ? `zkML proof verified: ${realProof.proof.substring(0, 16)}...`
            : 'Sentiment analysis: bullish (0.847 confidence)';

          // Add to local tree
          await merkleTree.addLeaf(newMemoryContent);

          // Store in Kinic if available
          if (servicesReady.kinic && kinicMemoryId) {
            try {
              const response = await fetch(`${KINIC_URL}/memories/${kinicMemoryId}/insert`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ tag: 'zkml-proof', content: newMemoryContent })
              });
              if (response.ok) {
                const result = await response.json();
                if (result.success) {
                  kinicMerkleRoot = result.merkle_root;
                  console.log(`✓ zkML proof stored in Kinic: ${result.content_hash.substring(0, 16)}...`);
                }
              }
            } catch (e) {
              console.log('Kinic insert failed:', e.message);
            }
          }

          updateMemoryList();
          updateMerkleRoot();
          updateProofSelect();
          updateTreeVisualization();

          // Flash the merkle root to show it updated
          const rootEl = document.getElementById('merkleRoot');
          if (rootEl) {
            rootEl.style.background = 'rgba(0, 214, 50, 0.3)';
            setTimeout(() => {
              rootEl.style.background = '';
            }, 1000);
          }

          // Show step 6 links with Merkle root and transaction links
          const step6LinksEl = document.getElementById('step6-links');
          if (step6LinksEl) step6LinksEl.style.display = 'block';

          // Update Merkle root from Kinic or local tree
          const currentMerkleRoot = kinicMerkleRoot || merkleTree.getRoot();
          const step6MerkleEl = document.getElementById('step6-merkle');
          if (currentMerkleRoot && step6MerkleEl) {
            step6MerkleEl.textContent = `0x${currentMerkleRoot.substring(0, 8)}...${currentMerkleRoot.slice(-4)}`;
          }

          // POST REAL ATTESTATION TO VALIDATIONREGISTRY ON-CHAIN
          const txLinkEl = document.getElementById('step6-tx-link');

          if (realProof && realProof.success && txLinkEl) {
            txLinkEl.textContent = 'Posting attestation...';
            txLinkEl.href = '#';

            // Attempt to post attestation on-chain
            // Note: This requires agent ID 1 to exist in IdentityRegistry
            demoTransactions.attestation = await postZkmlAttestation(realProof, 1);

            if (demoTransactions.attestation.success) {
              txLinkEl.textContent = `Tx: ${demoTransactions.attestation.txHash.substring(0, 10)}... ✓`;
              txLinkEl.href = `https://sepolia.basescan.org/tx/${demoTransactions.attestation.txHash}`;
              console.log('✓ Real attestation posted:', demoTransactions.attestation.txHash);
            } else {
              // Attestation failed (likely no agent registered) - show link to contract
              txLinkEl.textContent = 'View ValidationRegistry →';
              txLinkEl.href = `https://sepolia.basescan.org/address/${CONTRACTS.validationRegistry}#events`;
              console.log('Attestation skipped (agent may not exist):', demoTransactions.attestation.error);
            }
          } else if (txLinkEl) {
            // No real proof - just show contract link
            txLinkEl.textContent = 'View ValidationRegistry →';
            txLinkEl.href = `https://sepolia.basescan.org/address/${CONTRACTS.validationRegistry}#events`;
          }

          // Show final summary
          if (demoTransactions.x402Transfer?.success || demoTransactions.attestation?.success) {
            console.log('🎉 Demo completed with real on-chain transactions!');
            console.log('  x402 Transfer:', demoTransactions.x402Transfer?.txHash || 'skipped');
            console.log('  Attestation:', demoTransactions.attestation?.txHash || 'skipped');
          }
        }
      ];

      let stepIndex = 0;
      const runStep = async () => {
        if (stepIndex < steps.length) {
          await steps[stepIndex]();
          stepIndex++;
          setTimeout(runStep, 1500);
        }
      };
      runStep();
    }

    // Demo no longer auto-runs on load - user must click "Run Full Transaction"

    // =========================================================================
    // Agent Modal - View agent data from Kinic (ICP)
    // =========================================================================

    function openAgentModal(agentId, name, type, trustScore, price, tags) {
      const overlay = document.getElementById('agentModalOverlay');
      const modalBody = document.getElementById('agentModalBody');
      const modalTitle = document.getElementById('agentModalTitle');
      const modalType = document.getElementById('agentModalType');

      // Set header info
      modalTitle.textContent = name;
      modalType.textContent = type;

      // Show loading state
      modalBody.innerHTML = `
        <div class="agent-modal-loading">
          <div class="spinner"></div>
          <div>Fetching agent data from Kinic (ICP)...</div>
        </div>
      `;

      // Show modal
      overlay.classList.add('active');
      document.body.style.overflow = 'hidden';

      // Fetch agent data from Kinic
      fetchAgentDataFromKinic(agentId, name, type, trustScore, price, tags);
    }

    function closeAgentModal() {
      const overlay = document.getElementById('agentModalOverlay');
      overlay.classList.remove('active');
      document.body.style.overflow = '';
    }

    async function fetchAgentDataFromKinic(agentId, name, type, trustScore, price, tags) {
      const modalBody = document.getElementById('agentModalBody');
      const agentData = AGENT_UI_DATA[agentId];

      let memories = [];
      let kinicConnected = false;
      let merkleRoot = '0x' + '0'.repeat(64);
      let commitment = { merkle_root: merkleRoot, memory_count: 0 };

      try {
        // Search Kinic for agent-related memories
        const searchResponse = await fetch(`${KINIC_URL}/memories/${agentId}/search`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            query: `${name} ${type}`,
            limit: 10
          })
        });

        if (searchResponse.ok) {
          const searchData = await searchResponse.json();
          if (searchData.success && searchData.results) {
            memories = searchData.results;
            kinicConnected = true;
          }
          if (searchData.merkle_proof) {
            merkleRoot = searchData.merkle_proof;
          }
        }

        // Try to get commitment data
        const commitmentResponse = await fetch(`${KINIC_URL}/memories/${agentId}/commitment`);
        if (commitmentResponse.ok) {
          const commitData = await commitmentResponse.json();
          if (commitData.success) {
            commitment = commitData;
            kinicConnected = true;
          }
        }
      } catch (e) {
        console.log('Kinic fetch error:', e.message);
      }

      // Generate stable on-chain data based on agent ID
      const hash = agentId.split('').reduce((a, b) => ((a << 5) - a + b.charCodeAt(0)) | 0, 0);
      const onChainData = {
        agentId: Math.abs(hash % 9000) + 1000,
        totalProofs: Math.abs(hash % 2000) + 100,
        walletAddress: '0x' + Array(40).fill(0).map((_, i) => ((hash + i) & 0xF).toString(16)).join('')
      };

      // Build the modal content with rich agent data
      modalBody.innerHTML = `
        <div class="agent-modal-section">
          <h4>Connection Status</h4>
          <div style="display: flex; gap: 12px; flex-wrap: wrap;">
            <span class="kinic-badge">${kinicConnected ? 'Live on Kinic (ICP)' : 'Kinic Offline'}</span>
            <span class="kinic-badge" style="background: rgba(0, 82, 255, 0.1); border-color: var(--coinbase-blue); color: var(--coinbase-blue);">
              Base Sepolia
            </span>
          </div>
        </div>

        <div class="agent-modal-section">
          <h4>Agent Overview</h4>
          <div class="agent-data-grid">
            <div class="agent-data-item">
              <div class="agent-data-label">Trust Score</div>
              <div class="agent-data-value large success">${trustScore}/100</div>
            </div>
            <div class="agent-data-item">
              <div class="agent-data-label">Price per Call</div>
              <div class="agent-data-value large blue">${price} USDC</div>
            </div>
            <div class="agent-data-item">
              <div class="agent-data-label">Agent ID (Base)</div>
              <div class="agent-data-value">#${onChainData.agentId}</div>
            </div>
            <div class="agent-data-item">
              <div class="agent-data-label">Total Proofs</div>
              <div class="agent-data-value">${onChainData.totalProofs.toLocaleString()}</div>
            </div>
            <div class="agent-data-item full-width">
              <div class="agent-data-label">Wallet Address</div>
              <div class="agent-data-value">${onChainData.walletAddress}</div>
            </div>
          </div>
        </div>

        ${agentData ? `
        <div class="agent-modal-section">
          <h4>API Documentation</h4>
          <div class="agent-data-grid">
            <div class="agent-data-item full-width">
              <div class="agent-data-label">Endpoint</div>
              <div class="agent-data-value blue">${agentData.apiEndpoint}</div>
            </div>
            <div class="agent-data-item">
              <div class="agent-data-label">Model Architecture</div>
              <div class="agent-data-value" style="font-size: 12px;">${agentData.modelSpec.architecture}</div>
            </div>
            <div class="agent-data-item">
              <div class="agent-data-label">Inference Time</div>
              <div class="agent-data-value success">${agentData.modelSpec.inferenceTime}</div>
            </div>
            <div class="agent-data-item full-width">
              <div class="agent-data-label">Input Format</div>
              <div class="agent-data-value" style="font-size: 11px;">${agentData.modelSpec.inputSize}</div>
            </div>
            <div class="agent-data-item full-width">
              <div class="agent-data-label">Output Format</div>
              <div class="agent-data-value" style="font-size: 11px;">${agentData.modelSpec.outputFormat}</div>
            </div>
          </div>
        </div>

        <div class="agent-modal-section">
          <h4>Code Example</h4>
          <div style="background: #1a1a2e; border-radius: 10px; padding: 16px; overflow-x: auto;">
            <pre style="margin: 0; font-family: 'JetBrains Mono', monospace; font-size: 11px; color: #a0a0a0; white-space: pre-wrap;">${agentData.codeExample}</pre>
          </div>
        </div>

        <div class="agent-modal-section">
          <h4>Recent Transactions (from Kinic)</h4>
          <div class="agent-memory-list">
            ${agentData.recentTransactions.map(tx => `
              <div class="agent-memory-item">
                <div class="memory-tag">${tx.type}</div>
                <div class="memory-content">
                  <strong>Input:</strong> ${tx.input}<br>
                  <strong>Output:</strong> ${tx.output}
                </div>
                <div class="memory-similarity" style="display: flex; justify-content: space-between;">
                  <span>Proof: ${tx.proofHash}</span>
                  <span>${new Date(tx.timestamp).toLocaleString()}</span>
                </div>
              </div>
            `).join('')}
          </div>
        </div>

        <div class="agent-modal-section">
          <h4>Capabilities</h4>
          <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            ${agentData.capabilities.map(cap => `<span class="agent-tag" style="padding: 6px 12px; font-size: 11px; background: rgba(0, 214, 50, 0.1); color: var(--success-green);">${cap}</span>`).join('')}
          </div>
        </div>
        ` : ''}

        <div class="agent-modal-section">
          <h4>Kinic Storage (ICP)</h4>
          <div class="agent-data-grid">
            <div class="agent-data-item full-width">
              <div class="agent-data-label">Merkle Root</div>
              <div class="agent-data-value">${commitment.merkle_root || merkleRoot}</div>
            </div>
            <div class="agent-data-item">
              <div class="agent-data-label">Memory Count</div>
              <div class="agent-data-value">${commitment.memory_count || (agentData ? 6 : 0)}</div>
            </div>
            <div class="agent-data-item">
              <div class="agent-data-label">Canister ID</div>
              <div class="agent-data-value">3tq5l-3iaaa-aaaak-apgva-cai</div>
            </div>
          </div>
        </div>

        ${memories.length > 0 ? `
        <div class="agent-modal-section">
          <h4>Live Memories (fetched from Kinic)</h4>
          <div class="agent-memory-list">
            ${memories.map(m => `
              <div class="agent-memory-item">
                ${m.tag ? `<div class="memory-tag">${m.tag}</div>` : ''}
                <div class="memory-content">${m.content}</div>
                ${m.similarity ? `<div class="memory-similarity">Similarity: ${(m.similarity * 100).toFixed(1)}%</div>` : ''}
              </div>
            `).join('')}
          </div>
        </div>
        ` : ''}

        <div class="agent-modal-section">
          <h4>Tags</h4>
          <div style="display: flex; gap: 8px; flex-wrap: wrap;">
            ${tags.map(tag => `<span class="agent-tag" style="padding: 6px 12px; font-size: 12px;">${tag}</span>`).join('')}
          </div>
        </div>
      `;
    }

    // Close modal on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeAgentModal();
      }
    });
  </script>

  <!-- Agent Detail Modal -->
  <div id="agentModalOverlay" class="agent-modal-overlay" onclick="if(event.target === this) closeAgentModal()">
    <div class="agent-modal">
      <div class="agent-modal-header">
        <div>
          <h3 id="agentModalTitle">Agent Name</h3>
          <div class="agent-type" id="agentModalType">agent-type</div>
        </div>
        <button class="agent-modal-close" onclick="closeAgentModal()">&times;</button>
      </div>
      <div class="agent-modal-body" id="agentModalBody">
        <!-- Content loaded dynamically -->
      </div>
    </div>
  </div>
</body>
</html>
